var height="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;var width="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;var config=window.wizardConfig;var tab=config.project.tabs[page];var stackType=config.tabs[tab].stackType;var chartGroup0=config.charts[config.tabs[tab].charts[0]];var indicator=chartGroup0.options.indicator;if(stackType=="pyramids"){var chartGroup1={};chartGroup1["title"]=config.charts[config.tabs[tab].charts[0]].title;chartGroup1["definition"]=config.charts[config.tabs[tab].charts[0]].definition;chartGroup1["options"]=config.charts[config.tabs[tab].charts[0]].options;var indicator1=chartGroup1.options.indicator1}var country0;var country1="addCountry";$(document).ready(function(){if(stackType=="pyramids"){updateIndicator(indicator,"pageLoad","pyramidsRight");updateIndicator(indicator1,"pageLoad","pyramidsLeft")}else if(stackType=="lineWithBars"){updateIndicator(indicator,"pageLoad","lineWithBars")}else{updateIndicator(indicator,"pageLoad")}$("#chartTitle").val(config.tabs[tab].charts[0]);$("body").on("change","#countrySelect",function(){country0=$(this).val();if(stackType=="pyramids"){createStackedChart(window.chartGroup0,"container",country0,null,"pyramidsRight");createStackedChart(window.chartGroup1,"container",country0,null,"pyramidsLeft")}else if(stackType=="lineWithBars"){createStackedChart(window.chartGroup0,"container",country0,null,"lineWithBars")}else{createStackedChart(window.chartGroup0,"container",country0)}});$("body").on("change","#countrySelect1",function(){country1=$(this).val();if(stackType=="pyramids"){createStackedChart(window.chartGroup0,"container1",country1,null,"pyramidsRight");createStackedChart(window.chartGroup1,"container1",country1,null,"pyramidsLeft")}else if(stackType=="lineWithBars"){createStackedChart(window.chartGroup0,"container1",country1,null,"lineWithBars")}else{createStackedChart(window.chartGroup0,"container1",country1)}});$("#chartTitle").change(function(){var newindicator=$(this).val();indicator=config.charts[newindicator].options.indicator;if(stackType=="lineWithBars"){chartGroup0=config.charts[newindicator];updateIndicator(indicator,null,"lineWithBars")}else{updateIndicator(indicator)}})});function createStackedChart(chartData,container,country,mode,stackType){var countries=chartData.data.keys[0];country=country.toString().toUpperCase();var chart={};chart["title"]=chartData.title;chart["definition"]=chartData.definition;chart["options"]=chartData.options;if($.inArray(country,countries)>-1){chart["data"]=filterDimension(chartData.data,country)}else{chart["data"]=filterDimension(chartData.data,window.urlcountry);if(container=="container1"){window.country1=window.urlcountry}else{window.country0=window.urlcountry}}var tabLabels=config.tabs[tab].labels;var translatedLabels=window.lang_countries;if(tabLabels){$.each(tabLabels.labels,function(key,value){translatedLabels[key.toLowerCase()]=value.name})}var values=getChartWithLabels(chart,translatedLabels);if(mode=="newIndicator"){$("#countrySelect option").remove();$("#countrySelect1 option").remove();$("#countrySelect1").append('<option value="addCountry">'+lang_labels.addCountry+"</option>");$.each(lang_countries,function(key,value){if($.inArray(key.toString().toUpperCase(),countries)>-1){$("#countrySelect").append("<option value="+key+">"+value+"</option>");$("#countrySelect1").append("<option value="+key+">"+value+"</option>")}});$("#countrySelect").val(window.country0);$("#countrySelect1").val(window.country1)}if(stackType=="pyramidsRight"){addPyramidRight(values,container)}else if(stackType=="pyramidsLeft"){addPyramidLeft(values,container+"A")}else if(stackType=="lineWithBars"){addLineStackedBarChart(values,container)}else{addStackedAreaChart(values,container)}}function updateIndicator(indicator,mode,stackType){$.ajax({dataType:"json",url:baseURL+"/api-data?project="+window.project+"&id="+indicator,success:ajaxSuccess(mode,stackType),error:function(xhr,ajaxOptions,thrownError){if(xhr.status=="404"){alert("No data available.")}}})}function ajaxSuccess(mode,stackType){return function(data){if(data!=null){if(stackType=="pyramidsLeft"){window.country0=window.urlcountry;window.chartGroup1["data"]=data;createStackedChart(window.chartGroup1,"container",country0,"newIndicator",stackType);if(mode!="pageLoad"){createStackedChart(window.chartGroup1,"container1",country1,"newIndicator",stackType)}}else{window.chartGroup0["data"]=data;if($.inArray(window.urlcountry.toString().toUpperCase(),chartGroup0.data.keys[0])==-1){window.urlcountry=chartGroup0.data.keys[0][0]}window.country0=window.urlcountry;createStackedChart(window.chartGroup0,"container",country0,"newIndicator",stackType);if(mode!="pageLoad"){createStackedChart(window.chartGroup0,"container1",country1,"newIndicator",stackType)}}if(window.stackType=="pyramids"){$("#slider").slider({value:parseFloat(chartGroup0.data.keys[0][0]),min:parseFloat(chartGroup0.data.keys[0][0]),max:parseFloat(chartGroup0.data.keys[0][chartGroup0.data.keys[0].length-1]),step:1,slide:function(event,ui){$("#year").val(ui.value);createStackedChart(window.chartGroup0,"container1",ui.value,null,"pyramidsRight");createStackedChart(window.chartGroup1,"container1",ui.value,null,"pyramidsLeft")}});$("#year").val($("#slider").slider("value"))}}else{alert("No data available.")}}}function filterDimension(d,filter){filter=filter.toString().toUpperCase();var filterKeys=d.keys[0];var newData={};newData["dimensions"]=d.dimensions.slice(1);newData["keys"]=d.keys.slice(1);var filtered=filterKeys.indexOf(filter);newData["data"]=d.data[filtered];return newData}function flipData(d){var r={keys:d.keys.slice(0),dimensions:d.dimensions.slice(0)};r.keys.reverse();r.dimensions.reverse();r.data=r.keys[0].map(function(k,i0){return r.keys[1].map(function(k,i1){return d.data[i1][i0]})});return r}function getHumanReadData(number,decimals,trimZeros){if(decimals===undefined){decimals=0}if(decimals<0){return number}number=parseFloat(number);var abs=Math.abs(number);function decimalAdjust(type,value,exp){if(typeof exp==="undefined"||+exp===0){return Math[type](value)}value=+value;exp=+exp;if(isNaN(value)||!(typeof exp==="number"&&exp%1===0)){return NaN}value=value.toString().split("e");value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))}function toFixed(number,decimals){var s=decimalAdjust("round",number,-decimals).toFixed(decimals);return trimZeros?s.replace(/\.0+$|(\..*?)0+$/,"$1"):s}function spaceSeparateNumber(val){while(/(\d+)(\d{3})/.test(val.toString())){val=val.toString().replace(/(\d+)(\d{3})/,"$1"+" "+"$2")}return val}function commaSeparateNumber(val){while(/(\d+)(\d{3})/.test(val.toString())){val=val.toString().replace(/(\d+)(\d{3})/,"$1"+","+"$2")}return val}if(abs>1e12){return toFixed(number/1e12,decimals)+"&nbsp;"+window.lang_labels["trillion"]}else if(abs>1e9){return toFixed(number/1e9,decimals)+"&nbsp;"+window.lang_labels["billion"]}else if(abs>1e6){return toFixed(number/1e6,decimals)+"&nbsp;"+window.lang_labels["million"]}else if(abs>1e5){return toFixed(number/1e3,decimals)+"&nbsp;"+window.lang_labels["thousand"]}else{return spaceSeparateNumber(toFixed(number,decimals))}}var urlQuery=function(){var query_string={};var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(typeof query_string[pair[0]]==="undefined"){query_string[pair[0]]=decodeURIComponent(pair[1])}else if(typeof query_string[pair[0]]==="string"){var arr=[query_string[pair[0]],decodeURIComponent(pair[1])];query_string[pair[0]]=arr}else{query_string[pair[0]].push(decodeURIComponent(pair[1]))}}return query_string}();function getChartWithLabels(d,lang_countries){var newData={};newData["options"]=d.options;newData["title"]=d.title;newData["definition"]=d.definition;newData["data"]={};newData.data["dimensions"]=d.data.dimensions;newData.data["data"]=d.data.data;newData.data["keys"]=[];newData.data["keys"][0]=[];newData.data["keys"][1]=[];$.each(d.data.keys[0],function(key,val){if(val.toLowerCase()in lang_countries){newData.data["keys"][0][key]=lang_countries[val.toLowerCase()]}else{newData.data["keys"][0][key]=val}});$.each(d.data.keys[1],function(key,val){if(val.toLowerCase()in lang_countries){newData.data["keys"][1][key]=lang_countries[val.toLowerCase()]}else{newData.data["keys"][1][key]=val}});return newData}function ChartElement(){var self=this;var chart;self.loadChart=function(data,options){var newChart=new chartBasis(data,options);newChart.loadData();chart=newChart};self.displayCharts=function(container){chart.displayChart(container)}}function chartBasis(data,options){var self=this;var loadedData={};var defaults={highcharts:{chart:{backgroundColor:"transparent"},plotOptions:{series:{marker:{enabled:false,states:{hover:{enabled:true}}},pointPadding:0,borderWidth:0,connectNulls:true}},exporting:{enabled:false},legend:{enabled:false},credits:{enabled:false},title:{text:null},xAxis:{labels:{step:1,style:{fontSize:"1em"}}},yAxis:{title:{text:null}}},CYCoptions:{typeOfFirstSeries:null}};options=$.extend(true,defaults,options);self.loadData=function(){var Data=[];var categories=data.keys[1];$.each(data.keys[0],function(index,name){var dataPoints=data.data[index].map(function(y,i){if(y!=null){return{y:parseFloat(y.toFixed(options.CYCoptions.decimals)),id:categories[i],name:categories[i]}}else{return{y:null,id:categories[i]}}});Data.push({name:name,data:dataPoints})});if(options.CYCoptions.typeOfFirstSeries!=null){Data[0].type=options.CYCoptions.typeOfFirstSeries}loadedData={cats:categories,series:Data}};self.displayChart=function(container){var data=loadedData;if(data==null)return false;var seriesOptions={chart:{renderTo:container},xAxis:{categories:data.cats},series:data.series};options.highcharts=$.extend(true,options.highcharts,seriesOptions);new Highcharts.Chart(options.highcharts);return true}}function labelFormat(translatedLables){return function(){if(this.value.toUpperCase()in window.ISO3toFlags){var flag='<img  style="margin-bottom:4px" height=18px src="'+baseURL+"/flags.png?cr="+this.value.toUpperCase()+'">';return'<span style="margin-right:5px" >'+translatedLables[this.value.toLowerCase()]+"</span>"+flag}else{if(translatedLables[this.value.toLowerCase()]!=undefined){return'<span style="margin-right:5px" >'+translatedLables[this.value.toLowerCase()]+"</span>"}else{return'<span style="margin-right:5px" >'+this.value.toLowerCase()+"</span>"}}}}function tooltipFormat(values,translatedLables){return function(){if(translatedLables[this.x.toLowerCase()]!=undefined){var s="<b>"+translatedLables[this.x.toLowerCase()]+"</b>"}else{var s="<b>"+this.x+"</b>"}$.each(this.points,function(){s+="<br/>"+this.series.name+": "+this.y+" "+values.options.tooltipUnit});return s}}function addLineChart(values,container){Highcharts.setOptions({lang:{numericSymbols:null}});if(values.data.data[0]!=undefined){var sbars=new ChartElement;loadAndDisplayData()}function loadAndDisplayData(){sbars.loadChart(values.data,{highcharts:{chart:{type:"line"},legend:{enabled:true,verticalAlign:"top",padding:0,margin:10},plotOptions:{series:{markers:{enabled:false,states:{hover:{enabled:true}}},lineWidth:2}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{reversed:true,tickmarkPlacement:"on",labels:{style:{"font-size":"11px"},step:null}},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"},colors:["#de3a07","#408000","#dca2bf","#fdd14e","#730000","#ffa640","#234010","#6cc3d9","#4400ff","#f200a2","#750039","#33260d","#00e61f","#0099e6","#1f0073","#962c0b","#734939","#735c00","#00f2a2","#004996"]},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addLineStackedBarChart(values,container){if(values.data.data[0]!=undefined){var sbars=new ChartElement;loadAndDisplayData()}function loadAndDisplayData(){sbars.loadChart(values.data,{highcharts:{chart:{type:"column"},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{area:{stacking:"normal"},bar:{stacking:"normal"},column:{stacking:"normal"},series:{markers:{enabled:false,states:{hover:{enabled:true}}},lineWidth:2}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{tickmarkPlacement:"on",labels:{style:{"font-size":"11px"},step:null}},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals,typeOfFirstSeries:values.options.typeOfFirstSeries||"line"}});sbars.displayCharts(container)}}function addStackedAreaChart(values,container){if(values.data.data[0]!=undefined){var sbars=new ChartElement;loadAndDisplayData()}function loadAndDisplayData(){sbars.loadChart(values.data,{highcharts:{chart:{type:"area"},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{area:{stacking:"normal"},series:{markers:{enabled:false,states:{hover:{enabled:true}}},lineWidth:2}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{tickmarkPlacement:"on",labels:{style:{"font-size":"11px"},step:null}},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addBarChart(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){values.data=sortDimension0(values.data,0,desc=true);sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"bar",marginBottom:10},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{dataLabels:{enabled:true,overflow:"none",crop:false,allowOverlap:true}}},yAxis:{labels:{enabled:false},gridLineWidth:0,min:values.options.minimum,max:values.options.maximum},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addBarChartFlag(values,container,translatedLabels){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){values.data=sortDimension0(values.data,0,desc=true);sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"bar",marginBottom:10,marginLeft:150},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{dataLabels:{enabled:true,overflow:"none",crop:false,allowOverlap:true}}},yAxis:{labels:{enabled:false},gridLineWidth:0,min:values.options.minimum,max:values.options.maximum},xAxis:{labels:{useHTML:true,formatter:labelFormat(translatedLabels)}},tooltip:{shared:true,useHTML:true,formatter:tooltipFormat(values,translatedLabels)}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addColumnChart(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){values.data=sortDimension0(values.data,0,desc=true);sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"column"},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{dataLabels:{enabled:false,overflow:"none",crop:false,allowOverlap:true}}},yAxis:{min:values.options.minimum,max:values.options.maximum},colors:["#88b60f","#232323"],tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addBarsDiamondsChart(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){values.data=sortDimension0(values.data,0,desc=true);sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"line",marginBottom:20},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{marker:{enabled:true},lineWidth:0,states:{hover:{lineWidth:0,lineWidthPlus:0}}}},yAxis:{min:values.options.minimum,max:values.options.maximum},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{typeOfFirstSeries:"bar",decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addStackedColumnChart(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"column"},legend:{enabled:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{labels:{step:null}},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addStackedBarChart(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){values.data=sortDimension0sum(values.data,desc=true);sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"bar",marginBottom:20},legend:{enabled:true,reversed:true,verticalAlign:"top",padding:0,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addPyramidRight(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){sbars.loadChart(flipData(values.data),{highcharts:{title:{text:"Men"},chart:{type:"bar"},legend:{enabled:true,reversed:true,verticalAlign:"bottom",padding:5,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"},series:{animation:false}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{opposite:true},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}function addPyramidLeft(values,container){var sbars=new ChartElement;loadAndDisplayData();function loadAndDisplayData(){sbars.loadChart(flipData(values.data),{highcharts:{title:{text:"Women"},chart:{type:"bar"},legend:{enabled:true,reversed:true,verticalAlign:"bottom",padding:5,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"},series:{animation:false}},xAxis:{},yAxis:{min:values.options.minimum,max:values.options.maximum,reversed:true},tooltip:{shared:true,useHTML:true,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td>'+'<td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}});sbars.displayCharts(container)}}
//# sourceMappingURL=stacked.js.map