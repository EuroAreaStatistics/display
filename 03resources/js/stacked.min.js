function createStackedChart(chartData,container,country,mode,stackType){var countries=chartData.data.keys[0];country=country.toString().toUpperCase();var chart={};chart.title=chartData.title,chart.definition=chartData.definition,chart.options=chartData.options,$.inArray(country,countries)>-1?chart.data=filterDimension(chartData.data,country):(chart.data=filterDimension(chartData.data,window.urlcountry),"container1"==container?window.country1=window.urlcountry:window.country0=window.urlcountry);var tabLabels=config.tabs[tab].labels,translatedLabels=window.lang_countries;tabLabels&&$.each(tabLabels.labels,function(key,value){translatedLabels[key.toLowerCase()]=value.name});var values=getChartWithLabels(chart,translatedLabels);"newIndicator"==mode&&($("#countrySelect option").remove(),$("#countrySelect1 option").remove(),$("#countrySelect1").append('<option value="addCountry">'+lang_labels.addCountry+"</option>"),$.each(lang_countries,function(key,value){$.inArray(key.toString().toUpperCase(),countries)>-1&&($("#countrySelect").append("<option value="+key+">"+value+"</option>"),$("#countrySelect1").append("<option value="+key+">"+value+"</option>"))}),$("#countrySelect").val(window.country0),$("#countrySelect1").val(window.country1)),"pyramidsRight"==stackType?addPyramidRight(values,container):"pyramidsLeft"==stackType?addPyramidLeft(values,container+"A"):"lineWithBars"==stackType?addLineStackedBarChart(values,container):addStackedAreaChart(values,container)}function updateIndicator(indicator,mode,stackType){$.ajax({dataType:"json",url:baseURL+"/api-data?project="+window.project+"&id="+indicator,success:ajaxSuccess(mode,stackType),error:function(xhr,ajaxOptions,thrownError){"404"==xhr.status&&alert("No data available.")}})}function ajaxSuccess(mode,stackType){return function(data){null!=data?("pyramidsLeft"==stackType?(window.country0=window.urlcountry,window.chartGroup1.data=data,createStackedChart(window.chartGroup1,"container",country0,"newIndicator",stackType),"pageLoad"!=mode&&createStackedChart(window.chartGroup1,"container1",country1,"newIndicator",stackType)):(window.chartGroup0.data=data,-1==$.inArray(window.urlcountry.toString().toUpperCase(),chartGroup0.data.keys[0])&&(window.urlcountry=chartGroup0.data.keys[0][0]),window.country0=window.urlcountry,createStackedChart(window.chartGroup0,"container",country0,"newIndicator",stackType),"pageLoad"!=mode&&createStackedChart(window.chartGroup0,"container1",country1,"newIndicator",stackType)),"pyramids"==window.stackType&&($("#slider").slider({value:parseFloat(chartGroup0.data.keys[0][0]),min:parseFloat(chartGroup0.data.keys[0][0]),max:parseFloat(chartGroup0.data.keys[0][chartGroup0.data.keys[0].length-1]),step:1,slide:function(event,ui){$("#year").val(ui.value),createStackedChart(window.chartGroup0,"container1",ui.value,null,"pyramidsRight"),createStackedChart(window.chartGroup1,"container1",ui.value,null,"pyramidsLeft")}}),$("#year").val($("#slider").slider("value")))):alert("No data available.")}}function filterDimension(d,filter){filter=filter.toString().toUpperCase();var filterKeys=d.keys[0],newData={};newData.dimensions=d.dimensions.slice(1),newData.keys=d.keys.slice(1);var filtered=filterKeys.indexOf(filter);return newData.data=d.data[filtered],newData}function flipData(d){var r={keys:d.keys.slice(0),dimensions:d.dimensions.slice(0)};return r.keys.reverse(),r.dimensions.reverse(),r.data=r.keys[0].map(function(k,i0){return r.keys[1].map(function(k,i1){return d.data[i1][i0]})}),r}function getHumanReadData(number,decimals,trimZeros){function decimalAdjust(type,value,exp){return void 0===exp||0==+exp?Math[type](value):(value=+value,exp=+exp,isNaN(value)||"number"!=typeof exp||exp%1!=0?NaN:(value=value.toString().split("e"),value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))),value=value.toString().split("e"),+(value[0]+"e"+(value[1]?+value[1]+exp:exp))))}function toFixed(number,decimals){var s=decimalAdjust("round",number,-decimals).toFixed(decimals);return trimZeros?s.replace(/\.0+$|(\..*?)0+$/,"$1"):s}if(void 0===decimals&&(decimals=0),decimals<0)return number;number=parseFloat(number);var abs=Math.abs(number);return abs>1e12?toFixed(number/1e12,decimals)+"&nbsp;"+window.lang_labels.trillion:abs>1e9?toFixed(number/1e9,decimals)+"&nbsp;"+window.lang_labels.billion:abs>1e6?toFixed(number/1e6,decimals)+"&nbsp;"+window.lang_labels.million:abs>1e5?toFixed(number/1e3,decimals)+"&nbsp;"+window.lang_labels.thousand:function(val){for(;/(\d+)(\d{3})/.test(val.toString());)val=val.toString().replace(/(\d+)(\d{3})/,"$1 $2");return val}(toFixed(number,decimals))}function getChartWithLabels(d,lang_countries){var newData={};return newData.options=d.options,newData.title=d.title,newData.definition=d.definition,newData.data={},newData.data.dimensions=d.data.dimensions,newData.data.data=d.data.data,newData.data.keys=[],newData.data.keys[0]=[],newData.data.keys[1]=[],$.each(d.data.keys[0],function(key,val){val.toLowerCase()in lang_countries?newData.data.keys[0][key]=lang_countries[val.toLowerCase()]:newData.data.keys[0][key]=val}),$.each(d.data.keys[1],function(key,val){val.toLowerCase()in lang_countries?newData.data.keys[1][key]=lang_countries[val.toLowerCase()]:newData.data.keys[1][key]=val}),newData}function ChartElement(){var chart,self=this;self.loadChart=function(data,options){var newChart=new chartBasis(data,options);newChart.loadData(),chart=newChart},self.displayCharts=function(container){chart.displayChart(container)}}function chartBasis(data,options){var self=this,loadedData={},defaults={highcharts:{chart:{backgroundColor:"transparent"},plotOptions:{series:{marker:{enabled:!1,states:{hover:{enabled:!0}}},pointPadding:0,borderWidth:0,connectNulls:!0}},exporting:{enabled:!1},legend:{enabled:!1},credits:{enabled:!1},title:{text:null},xAxis:{labels:{step:1,style:{fontSize:"1em"}}},yAxis:{title:{text:null}}},CYCoptions:{typeOfFirstSeries:null}};options=$.extend(!0,defaults,options),self.loadData=function(){var Data=[],categories=data.keys[1];$.each(data.keys[0],function(index,name){var dataPoints=data.data[index].map(function(y,i){return null!=y?{y:parseFloat(y.toFixed(options.CYCoptions.decimals)),id:categories[i],name:categories[i]}:{y:null,id:categories[i]}});Data.push({name:name,data:dataPoints})}),null!=options.CYCoptions.typeOfFirstSeries&&(Data[0].type=options.CYCoptions.typeOfFirstSeries),loadedData={cats:categories,series:Data}},self.displayChart=function(container){var data=loadedData;if(null==data)return!1;var seriesOptions={chart:{renderTo:container},xAxis:{categories:data.cats},series:data.series};return options.highcharts=$.extend(!0,options.highcharts,seriesOptions),new Highcharts.Chart(options.highcharts),!0}}function labelFormat(translatedLables){return function(){if(this.value.toUpperCase()in window.ISO3toFlags){var flag='<img  style="margin-bottom:4px" height=18px src="'+baseURL+"/flags.png?cr="+this.value.toUpperCase()+'">';return'<span style="margin-right:5px" >'+translatedLables[this.value.toLowerCase()]+"</span>"+flag}return void 0!=translatedLables[this.value.toLowerCase()]?'<span style="margin-right:5px" >'+translatedLables[this.value.toLowerCase()]+"</span>":'<span style="margin-right:5px" >'+this.value.toLowerCase()+"</span>"}}function tooltipFormat(values,translatedLables){return function(){if(void 0!=translatedLables[this.x.toLowerCase()])var s="<b>"+translatedLables[this.x.toLowerCase()]+"</b>";else var s="<b>"+this.x+"</b>";return $.each(this.points,function(){s+="<br/>"+this.series.name+": "+this.y+" "+values.options.tooltipUnit}),s}}function addLineChart(values,container){if(Highcharts.setOptions({lang:{numericSymbols:null}}),void 0!=values.data.data[0]){var sbars=new ChartElement;!function(){sbars.loadChart(values.data,{highcharts:{chart:{type:"line"},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:10},plotOptions:{series:{markers:{enabled:!1,states:{hover:{enabled:!0}}},lineWidth:2}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{reversed:!0,tickmarkPlacement:"on",labels:{style:{"font-size":"11px"},step:null}},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"},colors:["#de3a07","#408000","#dca2bf","#fdd14e","#730000","#ffa640","#234010","#6cc3d9","#4400ff","#f200a2","#750039","#33260d","#00e61f","#0099e6","#1f0073","#962c0b","#734939","#735c00","#00f2a2","#004996"]},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}}function addLineStackedBarChart(values,container){if(void 0!=values.data.data[0]){var sbars=new ChartElement;!function(){sbars.loadChart(values.data,{highcharts:{chart:{type:"column"},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{area:{stacking:"normal"},bar:{stacking:"normal"},column:{stacking:"normal"},series:{markers:{enabled:!1,states:{hover:{enabled:!0}}},lineWidth:2}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{tickmarkPlacement:"on",labels:{style:{"font-size":"11px"},step:null}},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals,typeOfFirstSeries:values.options.typeOfFirstSeries||"line"}}),sbars.displayCharts(container)}()}}function addStackedAreaChart(values,container){if(void 0!=values.data.data[0]){var sbars=new ChartElement;!function(){sbars.loadChart(values.data,{highcharts:{chart:{type:"area"},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{area:{stacking:"normal"},series:{markers:{enabled:!1,states:{hover:{enabled:!0}}},lineWidth:2}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{tickmarkPlacement:"on",labels:{style:{"font-size":"11px"},step:null}},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}}function addBarChart(values,container){var sbars=new ChartElement;!function(){values.data=sortDimension0(values.data,0,desc=!0),sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"bar",marginBottom:10},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{dataLabels:{enabled:!0,overflow:"none",crop:!1,allowOverlap:!0}}},yAxis:{labels:{enabled:!1},gridLineWidth:0,min:values.options.minimum,max:values.options.maximum},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addBarChartFlag(values,container,translatedLabels){var sbars=new ChartElement;!function(){values.data=sortDimension0(values.data,0,desc=!0),sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"bar",marginBottom:10,marginLeft:150},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{dataLabels:{enabled:!0,overflow:"none",crop:!1,allowOverlap:!0}}},yAxis:{labels:{enabled:!1},gridLineWidth:0,min:values.options.minimum,max:values.options.maximum},xAxis:{labels:{useHTML:!0,formatter:labelFormat(translatedLabels)}},tooltip:{shared:!0,useHTML:!0,formatter:tooltipFormat(values,translatedLabels)}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addColumnChart(values,container){var sbars=new ChartElement;!function(){values.data=sortDimension0(values.data,0,desc=!0),sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"column"},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{dataLabels:{enabled:!1,overflow:"none",crop:!1,allowOverlap:!0}}},yAxis:{min:values.options.minimum,max:values.options.maximum},colors:["#88b60f","#232323"],tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addBarsDiamondsChart(values,container){var sbars=new ChartElement;!function(){values.data=sortDimension0(values.data,0,desc=!0),sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"line",marginBottom:20},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{series:{marker:{enabled:!0},lineWidth:0,states:{hover:{lineWidth:0,lineWidthPlus:0}}}},yAxis:{min:values.options.minimum,max:values.options.maximum},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{typeOfFirstSeries:"bar",decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addStackedColumnChart(values,container){var sbars=new ChartElement;!function(){sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"column"},legend:{enabled:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{labels:{step:null}},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addStackedBarChart(values,container){var sbars=new ChartElement;!function(){values.data=sortDimension0sum(values.data,desc=!0),sbars.loadChart(flipData(values.data),{highcharts:{chart:{type:"bar",marginBottom:20},legend:{enabled:!0,reversed:!0,verticalAlign:"top",padding:0,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addPyramidRight(values,container){var sbars=new ChartElement;!function(){sbars.loadChart(flipData(values.data),{highcharts:{title:{text:"Men"},chart:{type:"bar"},legend:{enabled:!0,reversed:!0,verticalAlign:"bottom",padding:5,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"},series:{animation:!1}},yAxis:{min:values.options.minimum,max:values.options.maximum},xAxis:{opposite:!0},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}function addPyramidLeft(values,container){var sbars=new ChartElement;!function(){sbars.loadChart(flipData(values.data),{highcharts:{title:{text:"Women"},chart:{type:"bar"},legend:{enabled:!0,reversed:!0,verticalAlign:"bottom",padding:5,margin:5},plotOptions:{bar:{stacking:"normal"},column:{stacking:"normal"},series:{animation:!1}},xAxis:{},yAxis:{min:values.options.minimum,max:values.options.maximum,reversed:!0},tooltip:{shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}'+values.options.tooltipUnit+"</b></td></tr>",footerFormat:"</table>"}},CYCoptions:{decimals:values.options.tooltipDecimals}}),sbars.displayCharts(container)}()}var height="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,width="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth,config=window.wizardConfig,tab=config.project.tabs[page],stackType=config.tabs[tab].stackType,chartGroup0=config.charts[config.tabs[tab].charts[0]],indicator=chartGroup0.options.indicator;if("pyramids"==stackType){var chartGroup1={};chartGroup1.title=config.charts[config.tabs[tab].charts[0]].title,chartGroup1.definition=config.charts[config.tabs[tab].charts[0]].definition,chartGroup1.options=config.charts[config.tabs[tab].charts[0]].options;var indicator1=chartGroup1.options.indicator1}var country0,country1="addCountry";$(document).ready(function(){"pyramids"==stackType?(updateIndicator(indicator,"pageLoad","pyramidsRight"),updateIndicator(indicator1,"pageLoad","pyramidsLeft")):"lineWithBars"==stackType?updateIndicator(indicator,"pageLoad","lineWithBars"):updateIndicator(indicator,"pageLoad"),$("#chartTitle").val(config.tabs[tab].charts[0]),$("body").on("change","#countrySelect",function(){country0=$(this).val(),"pyramids"==stackType?(createStackedChart(window.chartGroup0,"container",country0,null,"pyramidsRight"),createStackedChart(window.chartGroup1,"container",country0,null,"pyramidsLeft")):"lineWithBars"==stackType?createStackedChart(window.chartGroup0,"container",country0,null,"lineWithBars"):createStackedChart(window.chartGroup0,"container",country0)}),$("body").on("change","#countrySelect1",function(){country1=$(this).val(),"pyramids"==stackType?(createStackedChart(window.chartGroup0,"container1",country1,null,"pyramidsRight"),createStackedChart(window.chartGroup1,"container1",country1,null,"pyramidsLeft")):"lineWithBars"==stackType?createStackedChart(window.chartGroup0,"container1",country1,null,"lineWithBars"):createStackedChart(window.chartGroup0,"container1",country1)}),$("#chartTitle").change(function(){var newindicator=$(this).val();indicator=config.charts[newindicator].options.indicator,"lineWithBars"==stackType?(chartGroup0=config.charts[newindicator],updateIndicator(indicator,null,"lineWithBars")):updateIndicator(indicator)})});var urlQuery=function(){for(var query_string={},query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(void 0===query_string[pair[0]])query_string[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof query_string[pair[0]]){var arr=[query_string[pair[0]],decodeURIComponent(pair[1])];query_string[pair[0]]=arr}else query_string[pair[0]].push(decodeURIComponent(pair[1]))}return query_string}();
//# sourceMappingURL=stacked.js.map