{"version":3,"sources":["../../03/JScomponents/chartTypes/downloadPage.js"],"names":["downloadHandler","type","name","window","navigator","msSaveOrOpenBlob","data","$","removeClass","blob","Blob","document","createElement","URL","createObjectURL","each","revokeObjectURL","this","attr","remove","url","appendTo","click","link","encodeURIComponent","iframe","doc","contentDocument","contentWindow","open","write","close","execCommand","downloadError","jqXHR","textStatus","errorThrown","error","getResponseHeader","JSON","parse","responseText","e","alert","event","preventDefault","mimeType","addClass","ajax","dataType","accepts","text","success"],"mappings":"AAAA,QAASA,iBAAgBC,KAAMC,MAC7B,MAAIC,QAAOC,UAAUC,iBAAyB,SAASC,MACrDC,EAAE,QAAQC,YAAY,QACtBC,KAAO,GAAIC,OAAMJ,OAASL,KAAM,aAChCE,OAAOC,UAAUC,iBAAiBI,KAAMP,OAErC,YAAcS,UAASC,cAAc,MAAgC,MAAvBC,IAAIC,gBAAgC,SAASR,MAC9FC,EAAE,QAAQC,YAAY,QACtBD,EAAE,iBAAiBQ,KAAK,WACtBF,IAAIG,gBAAgBT,EAAEU,MAAMC,KAAK,WAEnCX,EAAE,iBAAiBY,QACnB,IAAIV,MAAO,GAAIC,OAAMJ,OAASL,KAAM,aAChCmB,IAAMP,IAAIC,gBAAgBL,KACnBF,GAAE,8CACVW,KAAK,OAAQE,KACbF,KAAK,WAAYhB,MACjBmB,SAAS,QACP,GAAGC,SAEN,YAAcX,UAASC,cAAc,KAAa,SAASN,MAC7DC,EAAE,QAAQC,YAAY,OACtB,IAAIe,MAAOhB,EAAE,4BACVW,KAAK,OAAQ,QAAQjB,KAAK,IAAIuB,mBAAmBlB,OACjDY,KAAK,WAAYhB,MACjBmB,SAAS,OACZE,MAAK,GAAGD,QACRC,KAAKJ,UAEA,SAASb,MACdC,EAAE,QAAQC,YAAY,OACtB,IAAIiB,QAASlB,EAAE,iCACZc,SAAS,QACRK,IAAMD,OAAO,GAAGE,iBAAmBF,OAAO,GAAGG,cAAcjB,QAC/De,KAAIG,KAAK5B,KAAM,WACfyB,IAAII,MAAMxB,MACVoB,IAAIK,QACJL,IAAIM,YAAY,UAAU,EAAM9B,OAIpC,QAAS+B,eAAcC,MAAOC,WAAYC,aACxC7B,EAAE,QAAQC,YAAY,OACtB,IAAI6B,OAAQD,aAAeD,YAAc,oBACzC,IAA8C,qBAA1CD,MAAMI,kBAAkB,gBAC1B,IACED,MAAQE,KAAKC,MAAMN,MAAMO,cAAcJ,MACvC,MAAOK,QACS,SAATL,QACTA,MAAQ,6CAEVM,OAAMN,OAGR9B,EAAE,WACDA,EAAE,8BAA8Be,MAAM,SAAUsB,OAC9CA,MAAMC,gBACN,IAAIC,UAAWvC,EAAEU,MAAMC,KAAK,YAC5BX,GAAE,QAAQwC,SAAS,QACnBxC,EAAEyC,MACA5B,IAAKb,EAAEU,MAAMC,KAAK,QAClB+B,SAAU,OACVC,SAAUC,KAAML,UAChBT,MAAOJ,cACPmB,QAASpD,gBAAgB8C,SAAUvC,EAAEU,MAAMC,KAAK","file":"downloadPage.min.js","sourcesContent":["function downloadHandler(type, name) {\n  if (window.navigator.msSaveOrOpenBlob) return function(data) {\n    $(\"body\").removeClass(\"wait\");\n    blob = new Blob([data], { type: 'text/csv' });\n    window.navigator.msSaveOrOpenBlob(blob, name);\n  };\n  if (('download' in document.createElement('a')) && URL.createObjectURL != null) return function(data) {\n    $(\"body\").removeClass(\"wait\");\n    $(\"#downloadLink\").each(function() {\n      URL.revokeObjectURL($(this).attr('href'));\n    });\n    $(\"#downloadLink\").remove();\n    var blob = new Blob([data], { type: 'text/csv' });\n    var url = URL.createObjectURL(blob);\n    var link = $('<a id=\"downloadLink\" style=\"display:none\">')\n      .attr('href', url)\n      .attr('download', name)\n      .appendTo('body');\n    link[0].click();\n  };\n  if ('download' in document.createElement('a')) return function(data) {\n    $(\"body\").removeClass(\"wait\");\n    var link = $('<a style=\"display:none\">')\n      .attr('href', 'data:'+type+','+encodeURIComponent(data))\n      .attr('download', name)\n      .appendTo('body');\n    link[0].click();\n    link.remove();\n  };\n  return function(data) {\n    $(\"body\").removeClass(\"wait\");\n    var iframe = $('<iframe style=\"display:none\">')\n      .appendTo('body');\n    var doc = iframe[0].contentDocument || iframe[0].contentWindow.document;\n    doc.open(type, 'replace');\n    doc.write(data);\n    doc.close();\n    doc.execCommand('SaveAs', true, name);\n  };\n}\n\nfunction downloadError(jqXHR, textStatus, errorThrown) {\n  $(\"body\").removeClass(\"wait\");\n  var error = errorThrown || textStatus || 'unknown AJAX error';\n  if (jqXHR.getResponseHeader('Content-type')==='application/json') {\n    try {\n      error = JSON.parse(jqXHR.responseText).error;\n    } catch (e) {} // ignore errors\n  } else if (error == \"error\") {\n    error = \"error fetching URL, see javascript console\";\n  }\n  alert(error);\n}\n\n$(function() {\n $(\".downloadPage a[data-type]\").click(function (event) {\n   event.preventDefault();\n   var mimeType = $(this).attr('data-type');\n   $(\"body\").addClass(\"wait\");\n   $.ajax({\n     url: $(this).attr('href'),\n     dataType: 'text',\n     accepts: {text: mimeType},\n     error: downloadError,\n     success: downloadHandler(mimeType, $(this).attr('download'))\n   });\n });\n});\n"]}