function getHumanReadData(number,decimals,trimZeros){function decimalAdjust(type,value,exp){return void 0===exp||0==+exp?Math[type](value):(value=+value,exp=+exp,isNaN(value)||"number"!=typeof exp||exp%1!=0?NaN:(value=value.toString().split("e"),value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))),value=value.toString().split("e"),+(value[0]+"e"+(value[1]?+value[1]+exp:exp))))}function toFixed(number,decimals){var s=decimalAdjust("round",number,-decimals).toFixed(decimals);return trimZeros?s.replace(/\.0+$|(\..*?)0+$/,"$1"):s}if(void 0===decimals&&(decimals=0),decimals<0)return number;number=parseFloat(number);var abs=Math.abs(number);return abs>1e12?toFixed(number/1e12,decimals)+"&nbsp;"+window.lang_labels.trillion:abs>1e9?toFixed(number/1e9,decimals)+"&nbsp;"+window.lang_labels.billion:abs>1e6?toFixed(number/1e6,decimals)+"&nbsp;"+window.lang_labels.million:abs>1e5?toFixed(number/1e3,decimals)+"&nbsp;"+window.lang_labels.thousand:function(val){for(;/(\d+)(\d{3})/.test(val.toString());)val=val.toString().replace(/(\d+)(\d{3})/,"$1 $2");return val}(toFixed(number,decimals))}function getPageCharts(wizardConfig,page){var tab=wizardConfig.project.tabs[page],charts=wizardConfig.tabs[tab].charts,pageCharts={};return $.each(charts,function(k,v){pageCharts[v]=wizardConfig.charts[v]}),pageCharts}function quarterlyData(chart){return chart.data&&/^\d{4}-Q\d$/.test(chart.data.keys[1][0])}function drawFourLines(){drawFourLinesMulti([{code:urlcountry,options:{}}])}function list(element,length){for(var a=[];length--;)a.push(element);return a}function updateColumnChart(dataKey){for(var i=0;i<NumberOfColumnCharts;i++)window["chart"+i].removeHighlights(SeriesColor1),window["chart"+i].removeHighlights(SeriesColor),window["chart"+i].highlightCountry(dataKey,SeriesColor1)}function highlightCountryColumn(countryCode,seriesColor){for(var i=0;i<NumberOfColumnCharts;i++)window["chart"+i].highlightCountry(countryCode,seriesColor)}function removeCountryHighlightColumn(countryCode){for(var i=0;i<NumberOfColumnCharts;i++)window["chart"+i].removeHighlightCountry(countryCode)}function drawColumns(){for(var chartOptions=[],i=0;i<NumberOfColumnCharts;i++)chartOptions[i]={yAxis:{plotLines:window["plotline"+i],min:window["minimum"+i],max:window["maximum"+i]},tooltip:window["tooltipA"+i]},window["chart"+i]=new MakeChart(DataColumns[i],"containerColumns"+i,chartOptions[i]),window["chart"+i].loadData()}function compareBy(x){return function(a,b){return a[x]-b[x]}}function objectUnion(obj1,obj2){for(var prop in obj2)"object"==typeof obj2[prop]&&void 0!=obj1[prop]?0==prop.indexOf("replace_")?obj1[prop.substring(8)]=obj2[prop]:obj1[prop]=objectUnion(obj1[prop],obj2[prop]):obj1[prop]=obj2[prop];return obj1}function commaSeparateNumber(val){for(;/(\d+)(\d{3})/.test(val.toString());)val=val.toString().replace(/(\d+)(\d{3})/,"$1,$2");return val}function drawFourLinesMulti(chartDefaults){$.each(chartDefaults,function(idx,chartDefault){$(".country-buttons[code='"+chartDefault.code+"']").addClass("buttondefault"),$(".country-buttons[code='"+chartDefault.code.toUpperCase()+"']").addClass("buttondefault"),chartDefaults[idx].code=chartDefault.code.toUpperCase()});var default_chart_collection={chart:null,source_url:null,data:null,options:null};charts=[];for(var i=0;i<NumberOfFourLinesCharts;i++)charts.push($.extend({},default_chart_collection));var default_options={chart:{zoomType:"x",resetZoomButton:{theme:{display:"none"}},events:{selection:function(ev){ev.xAxis&&$(ev.target.container).parent().parent().find("button.reset").show()}},type:"line",animation:!1,spacingBottom:5,margin:margins,backgroundColor:"rgba(255, 255, 255, 0.1)"},plotOptions:{series:{dashStyle:"solid",borderWidth:"0",shadow:!1,animation:!1,lineWidth:lineWidth,connectNulls:connectNulls,marker:{enabled:!connectNulls,radius:1,states:{hover:{enabled:!0,radius:4}}}}},legend:{enabled:!1},credits:{enabled:!1},xAxis:{tickmarkPlacement:"on",tickLength:6,plotBands:plotBand,categories:[],labels:labelsxAxis,lineWidth:1,min:xAxisMin},yAxis:{title:{text:null},minPadding:.2,maxPadding:.2,labels:yAxisLabels},title:{text:null},exporting:{enabled:!1},tooltip:tooltips,colors:colors};for(i=0;i<NumberOfFourLinesCharts;i++)charts[i].options=$.extend(!0,{},default_options,{chart:{renderTo:"container"+i},yAxis:{min:window["minimum"+i],max:window["maximum"+i],plotLines:plotLines[i]},tooltip:window["tooltip"+i],plotOptions:window["plotOptions"+i],xAxis:window["xAxisHide"+i]}),charts[i].source_url=window.DataFourLines[i];for(i in charts)charts[i].data={};var minValue=default_min,maxValue=default_max,numChartsToLoad=charts.length,minValue=default_min,maxValue=default_max,numChartsToLoad=charts.length;for(i in charts)!function(i){charts[i].source_url&&"string"!=typeof charts[i].source_url&&function(data){var key1,key2,ids=[];$.each(data.keys,function(k,v){$.isNumeric(v[0])?null==key2&&(key2=k):null==key1&&v.length>1&&(key1=k),ids.push(0)}),key1=0,key2=1;var dates=[];if(datetime_xAxis&&(charts[i].options.xAxis.type="datetime",charts[i].options.xAxis.dateTimeLabelFormats=datetime_formats,delete charts[i].options.xAxis.categories),$.each(data.keys[key2],function(k,v){if(datetime_xAxis){var a=v.split("-");if(a.length<2)a[1]=1;else{var m=a[1].match(/^Q([1-4])$/);null!==m&&(a[1]=3*m[1]-2)}dates.push(Date.UTC(a[0],a[1]-1))}else charts[i].options.xAxis.categories.push(v.toString())}),$.each(data.keys[key1],function(k,v){ids[key1]=k;for(var series={data:[],name:v},j=0;j<data.keys[key2].length;j++){ids[key2]=j;var d=data.data;$.each(ids,function(i,v){if(null===d)return!1;d=d[v]}),void 0===d&&(d=null),datetime_xAxis&&(d=[dates[series.data.length],d]),series.data.push(d)}charts[i].data[series.name.toUpperCase()]=series}),charts[i].options.series=[],$.each(chartDefaults,function(idx,chartDefault){var default_country_key=chartDefault.code;if(null!=default_country_key&&default_country_key.toLowerCase&&(default_country_key=default_country_key.toLowerCase()),chartDefault.code in charts[i].data){syncScale&&($.each(charts[i].data[chartDefault.code].data,function(idx,datapoint){$.isArray(datapoint)&&(datapoint=datapoint[1]),null!=datapoint&&((null==minValue||datapoint<minValue)&&(minValue=datapoint),(null==maxValue||datapoint>maxValue)&&(maxValue=datapoint))}),charts[i].data[chartDefault.code].dataMin=minValue,charts[i].data[chartDefault.code].dataMax=maxValue,charts[i].options.yAxis.min=minValue,charts[i].options.yAxis.max=maxValue);var chartSeries={id:chartDefault.code,name:lang_countries[default_country_key],data:charts[i].data[chartDefault.code].data,tag:chartDefault.code};$.extend(chartSeries,chartDefault.options),charts[i].options.series.push(chartSeries)}}),syncScale){if(0==--numChartsToLoad){for(var j in charts)charts[j].options.yAxis.min<minValue&&(minValue=charts[j].options.yAxis.min),charts[j].options.yAxis.max>maxValue&&(maxValue=charts[j].options.yAxis.max);for(var j in charts)charts[j].options.yAxis.min=minValue,charts[j].options.yAxis.max=maxValue,charts[j].chart=new Highcharts.Chart(charts[j].options)}}else charts[i].chart=new Highcharts.Chart(charts[i].options);$("#container"+i).parent().find("button.reset").click(function(i){return function(){$(this).hide(),charts[i].chart.zoomOut()}}(i))}(charts[i].source_url)}(i)}function MakeChart(datafile,container,options){var self=this;this.datafile=datafile,this.options=options,this.container=container,this.goaldata=[];this.loadData=function(){"string"!=typeof datafile&&self.parseJSONData(datafile)},this.parseJSONData=function(data){var key1,key2,ids=[];$.each(data.keys,function(k,v){$.isNumeric(v[0])?null==key2&&(key2=k):null==key1&&v.length>1&&(key1=k),ids.push(0)}),key1=0,key2=1;var years=data.keys[key2];$.each(data.keys[key1],function(k,v){ids[key1]=k;var countryName=v.toString(),isoCode=countryName;void 0!=isoCode&&(isoCode=isoCode.toLowerCase()),void 0!=isoCode&&void 0!=lang_countries[isoCode]&&(countryName=$(window).width()<450?"CRScodes"==ISOcodes?CRStoISO3[isoCode]:isoCode.toUpperCase():lang_countries[isoCode]);var items=[];$.each(data.keys[key2],function(k,v){ids[key2]=k;var d=data.data;$.each(ids,function(k,v){d=d[v]}),items.push(d)});for(var lastValue,lastYear,k=years.length-1;k>=0;k--){var v=years[k];if(lastYear=null==lastYear?"":" ("+v+")",!isNaN(parseFloat(items[k]))){lastValue=k;break}}if(null!=lastValue){var countryobj={name:countryName+lastYear,iso:isoCode.toUpperCase(),y:parseFloat(items[lastValue]),tooltip:commaSeparateNumber(parseFloat(items[lastValue]))};"oecd"==isoCode&&(countryobj.color=oecdColor),"OECD"==isoCode&&(countryobj.color=oecdColor),"20001"==isoCode&&(countryobj.color=oecdColor),"average"==isoCode&&(countryobj.color=oecdColor),self.goaldata.push(countryobj)}}),self.goaldata.sort(compareBy("y")),self.drawChart(self.goaldata,self.options)},this.drawChart=function(data,options){self.curData=data,defaultOptions={chart:{renderTo:self.container,type:"column",margin:marginsBar,backgroundColor:"rgba(255, 255, 255, 0.1)"},xAxis:{categories:function(data){var x=[];return $(data).each(function(i,e){x.push(e.name)}),x}(data),labels:{enabled:!1},tickWidth:0},yAxis:{title:{text:null},labels:labelsYaxis,gridLineWidth:gridLinesYaxis},series:[{data:data}],tooltip:{enabled:tooltips},plotOptions:{series:{borderWidth:"0",shadow:!1,animation:!0,pointPadding:.15,groupPadding:0,dataLabels:{enabled:!1,overflow:"none",crop:!1,allowOverlap:!0}},column:{stacking:"normal"}},colors:defaultColor,legend:{enabled:!1},credits:{enabled:!1},exporting:{enabled:!1},title:{text:self.title,align:"left",x:0,style:{fontSize:"14px"}}},options&&(defaultOptions=objectUnion(defaultOptions,options)),self.chart=new Highcharts.Chart(defaultOptions)},this.tooltipChartUrl=function(data){return""},this.sortChart=function(comparator){self.goaldata.sort(compareBy(comparator)),self.drawChart(self.goaldata,self.options)},this.matchSort=function(otherChart){var newGoalData=[],goalDataDict={};$.each(self.goaldata,function(ckey,cval){goalDataDict[cval.name]=cval}),$.each(otherChart.goaldata,function(ckey,cval){var dataItem=goalDataDict[cval.name];void 0!=dataItem&&newGoalData.push(dataItem)}),self.drawChart(newGoalData,self.options)},this.highlightCountry=function(iso,color){var datapoint,i;for(isoArr=[iso.toUpperCase()],i=0;i<self.curData.length;i++)datapoint=self.curData[i],isoArr.indexOf(datapoint.iso.toUpperCase())>=0&&(datapoint.oldColor=datapoint.color,datapoint.color=color);self.chart.series[0].setData(self.curData,!0)},this.highlightSecondaryCountries=function(isos,color){var datapoint,i;for(isoArr=[],$.each(isos,function(k,v){isoArr.push(v.toUpperCase())}),i=0;i<self.curData.length;i++)datapoint=self.curData[i],isoArr.indexOf(datapoint.iso.toUpperCase())>=0&&(datapoint.color=color);self.chart.series[0].setData(self.curData,!0)},this.removeHighlights=function(color){var datapoint,i;for(i=0;i<self.curData.length;i++)datapoint=self.curData[i],datapoint.color==color&&(datapoint.color=datapoint.oldColor);self.chart.series[0].setData(self.curData,!0)},this.removeHighlightCountry=function(iso){var datapoint,i;for(isoArr=[iso.toUpperCase()],i=0;i<self.curData.length;i++)datapoint=self.curData[i],isoArr.indexOf(datapoint.iso.toUpperCase())>=0&&(datapoint.color=datapoint.oldColor);self.chart.series[0].setData(self.curData,!0)}}function syncScales(){var i,min=null,max=null;for(i in charts)$.each(charts[i].chart.series,function(idx,series){if(series.visible&&("id"in series.options||"tag"in series.options)){var minValue,maxValue,id=series.options.id||series.options.tag;"dataMin"in charts[i].data[id]?(minValue=charts[i].data[id].dataMin,maxValue=charts[i].data[id].dataMax):(minValue=default_min,maxValue=default_max,$.each(charts[i].data[id].data,function(idx,datapoint){$.isArray(datapoint)&&(datapoint=datapoint[1]),null!=datapoint&&((null==minValue||datapoint<minValue)&&(minValue=datapoint),(null==maxValue||datapoint>maxValue)&&(maxValue=datapoint))}),charts[i].data[id].dataMin=minValue,charts[i].data[id].dataMax=maxValue),null!=minValue&&(null==min||minValue<min)&&(min=minValue),null!=maxValue&&(null==max||maxValue>max)&&(max=maxValue)}});for(i in charts)charts[i].chart.yAxis[0].setExtremes(min,max)}function updateChart(index){return function(){var params={cr:urlcountries,lg:lang,page:page,charts:window.Chart.slice()};embed&&(params.embed=1),null!=template&&(params.template=template),params.charts[index]=$(this).val();var url="/"+project,s="?";$.each(params,function(k,v){url+=s+encodeURIComponent(k)+"=",$.isArray(v)?url+=v.map(encodeURIComponent).join("+"):url+=encodeURIComponent(v),s="&"}),location=url}}function removeCountryFromChart(country){for(i in charts)if(void 0!=charts[i].data[country]){var chart=charts[i].chart;if(chart)for(var j=0;j<chart.series.length;j++)if(chart.series[j].options.tag==country){chart.series[j].remove();break}}}function addCountryToChart(country,SeriesColor){for(i in charts)if(void 0!=charts[i].data[country]){var chart=charts[i].chart;if(chart){var key=charts[i].data[country].name;key.toLowerCase&&(key=key.toLowerCase());var countryName=lang_countries[key],countryData=charts[i].data[country].data;chart.addSeries({name:countryName,data:countryData,tag:country,color:SeriesColor})}}}var NumberOfFourLinesCharts,NumberOfColumnCharts;1==template?NumberOfFourLinesCharts=Chart.length:2==template?NumberOfColumnCharts=Chart.length:3==template&&(NumberOfFourLinesCharts=Chart.length,NumberOfColumnCharts=Chart.length);for(var ConfigProject=getPageCharts(wizardConfig,page),syncScale=wizardConfig.tabs[wizardConfig.project.tabs[page]].syncScale,tabID=wizardConfig.project.tabs[page],DataFourLines=[],i=0;i<NumberOfFourLinesCharts;i++)DataFourLines[i]=ConfigProject[Chart[i]].data;for(var DataColumns=[],i=0;i<NumberOfColumnCharts;i++)DataColumns[i]=ConfigProject[Chart[i]].data;var charts,plotBand=null,plotLines={},tooltips={enabled:!0},lineWidth=3,connectNulls=!0,datetime_xAxis=!0;"category"==ConfigProject[Chart[0]].options.xaxis&&(datetime_xAxis=!1);var datetime_formats={year:"%Y"},labelsxAxis={enabled:!0,autoRotation:[0],style:{fontSize:"12px"}},yAxisLabels={style:{fontSize:"12px",textOverflow:"none",whiteSpace:"nowrap"},align:"left",x:0,y:-3},selectedCountries=[],selectedColors=[],default_min=null,default_max=null,options,clicked=!1,goaldata=[],marginsBar=[0,10,10,5],margins=[20,10,25,10];"category"==ConfigProject[Chart[0]].options.xaxis&&(margins=[20,10,null,10]);var labelsYaxis={enabled:!1},gridLinesYaxis=0,tooltips=!0,xAxisMin=null,colors=["#0072be","#de3a07"],defaultColor=["#c3c3c3"],urlcountryColor="#0071c4",oecdColor="#646464",SeriesColor="#408000",SeriesColor1="#ff0000",tooltip={shared:!0,useHTML:!0,headerFormat:"<small>{point.key}</small><table>",pointFormat:"",footerFormat:"</table>",valueDecimals:0},tooltipA={shared:!0,useHTML:!0,headerFormat:"{point.key}<table>",pointFormat:"",footerFormat:"</table>",valueDecimals:0};if(3==template){var yAxisLabels={style:{fontSize:"10px"},align:"right",x:-7,y:3},margins=[15,10,25,35],marginsBar=[15,0,25,10],gridLinesYaxis=1;$(document).ready(function(){$(document).tooltip({tooltipClass:"custom-tooltip-styling"})})}if("ecb"==themeURL)var lineWidth=2,connectNulls=!1,colors=["#004996"],datetime_formats={year:"%y"};for(i=0;i<NumberOfFourLinesCharts;i++)window["tooltip"+i]={enabled:!0},window["maximum"+i]=null,window["minimum"+i]=null;for(var i=0;i<NumberOfColumnCharts;i++)window["chart"+i],window["plotline"+i]=null,window["tooltipA"+i]={enabled:!0};!function(){function humanPoint(pointFormat){var s;s=this.points[0].series.tooltipHeaderFormatter?this.points[0].series.tooltipHeaderFormatter(this.points[0]):pointFormat.tooltipHeaderFormatter?pointFormat.tooltipHeaderFormatter(this.points[0]):pointFormat.tooltipFooterHeaderFormatter(this.points[0]);for(var i=0;i<this.points.length;i++){var options=this.points[i].series.tooltipOptions;s+='<tr><td style="color: '+this.points[i].series.color,s+='">'+this.points[i].series.name,s+=': </td><td style="text-align: right"><b>',s+=options.valuePrefix||"",s+=getHumanReadData(this.points[i].y,options.valueDecimals),s+=options.valueSuffix||"",s+="</b></td></tr>"}return s+=this.points[0].series.tooltipOptions.footerFormat}for(var i=0;i<window.Chart.length;i++){var chart=wizardConfig.charts[window.Chart[i]];window["tooltip"+i]=$.extend({},tooltip,{pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>{point.y}</b></td></tr>',valueDecimals:chart.options.tooltipDecimals,valueSuffix:chart.options.tooltipUnit,formatter:humanPoint}),quarterlyData(chart)&&(window["tooltip"+i].dateTimeLabelFormats={month:"%Y-Q%Q"}),window["tooltipA"+i]=$.extend({},tooltipA,{pointFormat:'<tr><td style="color: {series.color} text-align: left"><small>{point.y}</small></td></tr>',valueDecimals:chart.options.tooltipDecimals,valueSuffix:chart.options.tooltipUnit}),window["minimum"+i]=chart.options.minimum,window["maximum"+i]=chart.options.maximum,null!=chart.plotLines&&(plotLines[i]=chart.plotLines.map(function(l){return $.extend(!0,{color:"#000000",dashStyle:"Dash",width:2,label:{align:"right",style:{color:"#606060",fontSize:"10px"}}},l)}))}}(),void 0!=wizardConfig.tabs[tabID].plotband&&"projections"==wizardConfig.tabs[tabID].plotband[0]&&(plotBand=[{color:"#C6C9FF",from:Date.UTC(wizardConfig.tabs[tabID].plotband[1].start,0,0),to:Date.UTC(wizardConfig.tabs[tabID].plotband[1].end,0,0)}],$(function(){$("#legendleft").show(),$("#legendleft").html("<ul><li><span class='sharebutton' style='background-color:#C6C9FF; margin-right: 5px; padding-top: 0px; padding-bottom: 0px;'></span><span style='color:#000000;'> = "+lang_labels.projections+"</span></li></ul>")})),void 0!=wizardConfig.tabs[tabID].xAxisMin&&(xAxisMin=wizardConfig.tabs[tabID].xAxisMin),$(function(){drawFourLines(),drawColumns(),$("button.country-buttons.buttondefault").attr("series",1).addClass("buttonactive").removeClass("buttondefault"),highlightCountryColumn(urlcountry.toUpperCase(),"#0071c4"),$("button.country-buttons").click(function(){var country=$(this).attr("code").toUpperCase();if($(this).hasClass("buttonactive"))removeCountryFromChart(country),removeCountryHighlightColumn(country),$(this).removeClass("buttonactive"),$(this).removeAttr("series"),urlcountries.indexOf(country.toLowerCase())>-1&&urlcountries.splice(urlcountries.indexOf(country.toLowerCase()),1);else{var activeSeries={};$(this).closest(".buttonpanel").find("button.country-buttons.buttonactive").each(function(){activeSeries[$(this).attr("series")]=this});for(var series=1;series in activeSeries&&series<=maxSeries;)series++;if(series>maxSeries){series=maxSeries;var countryToRemove=$(activeSeries[series]).attr("code").toUpperCase();removeCountryFromChart(countryToRemove),removeCountryHighlightColumn(countryToRemove),$(activeSeries[series]).removeClass("buttonactive"),$(activeSeries[series]).removeAttr("series"),urlcountries.indexOf(countryToRemove.toLowerCase())>-1&&urlcountries.splice(urlcountries.indexOf(countryToRemove.toLowerCase()),1)}$(this).attr("series",series),$(this).addClass("buttonactive"),addCountryToChart(country,$(this).css("background-color")),highlightCountryColumn(country,$(this).css("background-color")),urlcountries.indexOf(country.toLowerCase())<0&&urlcountries.push(country.toLowerCase()),1==series&&(urlcountry=country.toLowerCase())}syncScale&&syncScales()}),urlcountries.slice(1,maxSeries).forEach(function(code){code=code.toUpperCase(),$("button.country-buttons").filter(function(){return $(this).attr("code").toUpperCase()===code}).filter(":visible").trigger("click")}),$("#countrySelect1").change(function(){setData($(this).attr("value")),updateColumnChart($(this).attr("value"))}),$.each(window.Chart,function(k,v){$("#DataSelect"+k).val(v),$("#DataSelect"+k).change(updateChart(k))}),$(".DefI").hide(),$("#def").show(),"ecb"!=themeURL&&$("#dload").hide(),$(".definitionsWrapper").hide(),$(".downloadsWrapper").hide(),$("#def").click(function(){$(".definitionsWrapper").toggle(),$(".downloadsWrapper").hide()}),$("#dload").click(function(){$(".downloadsWrapper").toggle(),$(".definitionsWrapper").hide()}),$("#titleDisplaySelectInstruction").show()}),setData=function(){var lastCountryCode=null;return function(countrycode){""===countrycode&&(countrycode=null),null!=countrycode&&countrycode.toUpperCase&&(countrycode=countrycode.toUpperCase()),null!=lastCountryCode&&removeCountryFromChart(lastCountryCode),lastCountryCode=countrycode;null!=countrycode&&addCountryToChart(countrycode,"#E04514"),syncScale&&syncScales()}}();
//# sourceMappingURL=fourLines.js.map