function getHumanReadData(number,decimals,trimZeros){function decimalAdjust(type,value,exp){return void 0===exp||0==+exp?Math[type](value):(value=+value,exp=+exp,isNaN(value)||"number"!=typeof exp||exp%1!=0?NaN:(value=value.toString().split("e"),value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))),value=value.toString().split("e"),+(value[0]+"e"+(value[1]?+value[1]+exp:exp))))}function toFixed(number,decimals){var s=decimalAdjust("round",number,-decimals).toFixed(decimals);return trimZeros?s.replace(/\.0+$|(\..*?)0+$/,"$1"):s}if(void 0===decimals&&(decimals=0),decimals<0)return number;number=parseFloat(number);var abs=Math.abs(number);return abs>1e12?toFixed(number/1e12,decimals)+"&nbsp;"+window.lang_labels.trillion:abs>1e9?toFixed(number/1e9,decimals)+"&nbsp;"+window.lang_labels.billion:abs>1e6?toFixed(number/1e6,decimals)+"&nbsp;"+window.lang_labels.million:abs>1e5?toFixed(number/1e3,decimals)+"&nbsp;"+window.lang_labels.thousand:function(val){for(;/(\d+)(\d{3})/.test(val.toString());)val=val.toString().replace(/(\d+)(\d{3})/,"$1 $2");return val}(toFixed(number,decimals))}function getLatestYearData(data){var newData={},latestYear=data.keys[1].length-1;return $.each(data.keys[0],function(key,value){for(newData[value]=[];null==data.data[data.keys[0].indexOf(value)][latestYear]&&latestYear>=0;)latestYear-=1;newData[value][0]=data.keys[1][latestYear],newData[value][1]=data.data[data.keys[0].indexOf(value)][latestYear],latestYear=data.keys[1].length-1}),newData}function filterYear(d,filter){var newData={};newData.title=d.title,newData.definition=d.definition,newData.options=d.options,newData.data={},newData.data.dimensions=d.data.dimensions,newData.data.keys=[],newData.data.keys[0]=d.data.keys[0],newData.data.keys[1]=[],newData.data.data=[];var idxYear=[];return $.each(filter,function(key,value){idxYear.push(d.data.keys[1].indexOf(value)),newData.data.keys[1].push(value)}),$.each(newData.data.keys[0],function(key,cr){newData.data.data[key]=[],$.each(idxYear,function(yKey,value){newData.data.data[key].push(d.data.data[key][value])})}),newData}function getMapData(wizardConfig,page,countrylist,Chart){function minValueLatest(series){var min=null;return $.each(series,function(k,v){null!=(v=v[1])&&(null==min?min=v:min>v&&(min=v))}),min}function maxValueLatest(series,arrayValue){var max=null;return $.each(series,function(k,v){null!=(v=v[arrayValue])&&(null==max?max=v:max<v&&(max=v))}),max}function getCountryData(series,group){var data={};return $.each(series,function(k,v){$.inArray(k,group)>-1&&(data[k]=v)}),data}var tab=wizardConfig.project.tabs[page],mapType=wizardConfig.tabs[tab].mapType,flowStatus=wizardConfig.tabs[tab].type,ConfigProject=function(wizardConfig,page){var tab=wizardConfig.project.tabs[page],charts=wizardConfig.tabs[tab].charts,pageCharts=[];return $.each(charts,function(k,v){pageCharts.push(wizardConfig.charts[v])}),pageCharts}(wizardConfig,page),DataforMap=[],DataforMap1=[],data={defaultLayer:null!=Chart?Math.max(0,wizardConfig.tabs[tab].charts.indexOf(Chart[0])):0};if("TwoIndicatorsSplitOnYears"==mapType){var labels=wizardConfig.tabs[tab].labels,key=0;$.each(labels.order,function(order,value){$.inArray(value,ConfigProject[0].data.keys[1])>-1&&(DataforMap[key]=filterYear(ConfigProject[0],[value]),labels.labels[value]?(DataforMap[key].title=labels.labels[value].name,DataforMap[key].unit=labels.labels[value].unit):(DataforMap[key].title=value,DataforMap[key].unit=""),DataforMap[key].code=value,DataforMap[key].definition=value,DataforMap[key].values=getCountryData(getLatestYearData(DataforMap[key].data),countrylist),ConfigProject[0].options.minimum&&null!=ConfigProject[0].options.minimum?DataforMap[key].min=ConfigProject[0].options.minimum:DataforMap[key].min=minValueLatest(DataforMap[key].values),ConfigProject[0].options.maximum&&null!=ConfigProject[0].options.maximum?DataforMap[key].max=ConfigProject[0].options.maximum:DataforMap[key].max=maxValueLatest(DataforMap[key].values,1),DataforMap[key].latestYear=maxValueLatest(DataforMap[key].values,0),key++)}),null!=ConfigProject[1]&&$.each(ConfigProject[1].data.keys[1],function(key,value){DataforMap1[key]=filterYear(ConfigProject[1],[value]),labels.labels[value]?DataforMap1[key].title=labels.labels[value].name:DataforMap1[key].title=value,DataforMap1[key].code=value,DataforMap1[key].definition=value,DataforMap1[key].values=getCountryData(getLatestYearData(DataforMap1[key].data),countrylist),ConfigProject[1].options.minimum&&null!=ConfigProject[1].options.minimum?DataforMap1[key].min=ConfigProject[1].options.minimum:DataforMap1[key].min=minValueLatest(DataforMap1[key].values),ConfigProject[1].options.maximum&&null!=ConfigProject[1].options.maximum?DataforMap1[key].max=ConfigProject[1].options.maximum:DataforMap1[key].max=maxValueLatest(DataforMap1[key].values,1),DataforMap1[key].latestYear=maxValueLatest(DataforMap1[key].values,0)})}else $.each(ConfigProject,function(chart,values){"flow"!=values.type&&DataforMap.push(function(){return mobx.observable({get id(){return chart},get title(){return values.title[lang]},get definition(){return values.definition[lang]},get options(){return values.options},get years(){return values.data.keys[1]},selectedYear:(window.location.search.match(/[?&]t=([^&]*)/)||["",null])[1],get data(){return(null===this.selectedYear?values:filterYear(values,[this.selectedYear])).data},get _values(){return getCountryData(getLatestYearData(this.data),countrylist)},get values(){if("mapRegion"in this.options){var v=$.extend({},this._values);return v[this.options.mapRegion]=getLatestYearData(this.data)[this.options.mapRegion],v}return this._values},get _min(){return this.options.minimum&&null!=this.options.minimum?this.options.minimum:minValueLatest(this._values)},get _max(){return this.options.maximum&&null!=this.options.maximum?this.options.maximum:maxValueLatest(this._values,1)},get latestYear(){return maxValueLatest(this._values,0)},get dMax(){return Math.max(Math.abs(this._min),Math.abs(this._max))},get dMin(){return-this.dMax},get minColor(){return quantize(this._min,this.dMin,this.dMax,MapColors.map(function(x,idx){return idx}))},get maxColor(){return quantize(this._max,this.dMin,this.dMax,MapColors.map(function(x,idx){return idx}))},get colors(){if(this.options.mapDivergent){if(this.minColor>0)return MapColors.slice(this.minColor);if(this.maxColor+1<MapColors.length)return MapColors.slice(0,this.maxColor+1)}return MapColors},get min(){return this.options.mapDivergent&&this.minColor>0?this.dMin+this.minColor*(this.dMax-this.dMin)/MapColors.length:this._min},get max(){return this.options.mapDivergent&&!(this.minColor>0)&&this.maxColor+1<MapColors.length?this.dMax-(MapColors.length-(this.maxColor+1))*(this.dMax-this.dMin)/MapColors.length:this._max}},{values:mobx.computed({keepAlive:!0}),min:mobx.computed({keepAlive:!0}),max:mobx.computed({keepAlive:!0}),colors:mobx.computed({keepAlive:!0}),latestYear:mobx.computed({keepAlive:!0})},{deep:!1,name:"map"})}())});return data.map=DataforMap,data.map1=DataforMap1,data.flow=flowStatus,mobx.observable({defaultLayer:data.defaultLayer,get map(){return data.map},get map1(){return data.map1},get flow(){return data.flow}},{},{deep:!1,name:"DataforMapAll"})}function getIndicatorColorScale(d,dMin,dMax,feature,colors){return $.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1?quantize(d,dMin,dMax,colors):landmass}function quantize(d,dMin,dMax,range){return range[function(d,dMin,dMax,scaleMin,scaleMax){var i=Math.floor((d-dMin)/(dMax-dMin)*(scaleMax-scaleMin+1))+scaleMin;return i<scaleMin?scaleMin:i>scaleMax?scaleMax:i}(d,dMin,dMax,0,range.length-1)]}function getBubbleSize(d,dMax,feature){if(null==d||d<=0)return null;var radius=25*Math.sqrt(d/dMax);return radius<3&&(radius=3),radius}function getDisputedLines(lines,group){var disputedLinesNew={type:"FeatureCollection",features:[]};return($.inArray("ind",group)>-1||$.inArray("chn",group)>-1||$.inArray("pak",group)>-1)&&$.each(lines.features,function(k,feature){"IndiaChinaPakistan"==feature.properties.SOVEREIGNT&&disputedLinesNew.features.push(feature)}),($.inArray("ind",group)>-1||$.inArray("chn",group)>-1)&&$.each(lines.features,function(k,feature){"IndiaChina"==feature.properties.SOVEREIGNT&&disputedLinesNew.features.push(feature)}),($.inArray("egy",group)>-1||$.inArray("sdn",group)>-1)&&$.each(lines.features,function(k,feature){"EgyptSudan"==feature.properties.SOVEREIGNT&&disputedLinesNew.features.push(feature)}),($.inArray("sdn",group)>-1||$.inArray("ssd",group)>-1)&&$.each(lines.features,function(k,feature){"Sudan"==feature.properties.SOVEREIGNT&&disputedLinesNew.features.push(feature)}),($.inArray("ken",group)>-1||$.inArray("som",group)>-1)&&$.each(lines.features,function(k,feature){"KenyaSom"==feature.properties.SOVEREIGNT&&disputedLinesNew.features.push(feature)}),disputedLinesNew}function getMapSubPoints(mapCentroides){if("ecb"!=themeURL){var mapSubPoints={type:"FeatureCollection",features:[]},smallIslands=["AND","ATG","AIA","ASM","ABW","ALA","BRB","BLM","BMU","BVT","CCK","COK","CPV","CUW","CXR","DMA","FLK","FSM","GRD","GGY","GIB","GLP","SGS","GUM","HKG","IMN","JEY","KIR","COM","KNA","CYM","LCA","LIE","MCO","MAF","MHL","MAC","MNP","MTQ","MSR","MLT","MUS","MDV","NFK","NRU","NIU","PYF","SPM","PCN","PRI","PLW","REU","SYC","SHN","SJM","SMR","STP","SXM","TCA","ATF","TKL","TON","TTO","TUV","VAT","VCT","VGB","VIR","WLF","WSM","MYT","ANT"];return $(mapCentroides.features).each(function(feature){$.inArray(this.properties[mapCode],smallIslands)>-1&&mapSubPoints.features.push(this)}),mapSubPoints}}function addMapLayers(bubbleMap,mapdataviz,flowStatus){var bubbles=[],layerName=[];if("multiColored"==bubbleMap){L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:!1}).addTo(mapdataviz);var i=0,matchIndex=[];$.each(DataforMap,function(key,value){if($.each(DataforMap1,function(key1,value1){value1.title==value.title&&(matchIndex[key]=key1+1)}),matchIndex[key])var colorIndicator=DataforMap1[matchIndex[key]-1];else var colorIndicator=null;bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSizeColorGeneric(value,colorIndicator),onEachFeature:highlightAndPopup}),layerName[$("<div>").html(DataforMap[i].title).text()]=bubbles[i],i++}),bubbles[0].addTo(mapdataviz),updateMultiLegend(DataforMap[0],"size"),updateMultiLegend(DataforMap1[matchIndex[0]-1],"color"),window.mapLayerIndex=0,window.mapLayerMatchIndex=matchIndex,DataforMap.length>1&&($(window).width()<750?L.control.layers(layerName,null,{collapsed:!0}).addTo(mapdataviz):L.control.layers(layerName,null,{collapsed:!1}).addTo(mapdataviz)),$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateMultiLegend(DataforMap[index],"size"),updateMultiLegend(DataforMap1[matchIndex[index]-1],"color"),mapdataviz.closePopup(),window.mapLayerIndex=index})}else if("colored"==bubbleMap){for(L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:!1}).addTo(mapdataviz),i=0;i<DataforMap.length-1;i++)bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSizeColorGeneric(DataforMap[0],DataforMap[i+1]),onEachFeature:highlightAndPopup}),layerName[$("<div>").html(DataforMap[i+1].title).text()]=bubbles[i];bubbles[0].addTo(mapdataviz),updateLegend(DataforMap[0],"size"),updateLegend(DataforMap[1],"color"),DataforMap.length-1>1&&($(window).width()<750?L.control.layers(layerName,null,{collapsed:!0}).addTo(mapdataviz):L.control.layers(layerName,null,{collapsed:!1}).addTo(mapdataviz)),$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateLegend(DataforMap[index+1],"color")})}else if("coloredPairUnpair"==bubbleMap){for(L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:!1}).addTo(mapdataviz),i=0;i<DataforMap.length/2;i++)bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSizeColorGeneric(DataforMap[2*i],DataforMap[2*i+1]),onEachFeature:highlightAndPopup}),layerName[$("<div>").html(DataforMap[2*i].title).text()]=bubbles[i];bubbles[0].addTo(mapdataviz),updateLegend(DataforMap[0],"size"),updateLegend(DataforMap[1],"color"),DataforMap.length-1>1&&($(window).width()<750?L.control.layers(layerName,null,{collapsed:!0}).addTo(mapdataviz):L.control.layers(layerName,null,{collapsed:!1}).addTo(mapdataviz)),$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateLegend(DataforMap[2*index],"size"),updateLegend(DataforMap[2*index+1],"color")})}else if("simple"==bubbleMap){for(L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:!1}).addTo(mapdataviz),i=0;i<DataforMap.length;i++)bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSimpleGeneric(DataforMap[i]),onEachFeature:highlightAndPopup}),layerName[$("<div>").html(DataforMap[i].title).text()]=bubbles[i];bubbles[0].addTo(mapdataviz),"flow"==flowStatus?(updateLegend(DataforMap[0],"flows"),updateFlowData(DataforMap[0].code),window.maxBubble=DataforMap[0].max):updateLegend(DataforMap[0],"size"),DataforMap.length>1&&($(window).width()<750?L.control.layers(layerName,null,{collapsed:!0}).addTo(mapdataviz):L.control.layers(layerName,null,{collapsed:!1}).addTo(mapdataviz)),$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();"flow"==flowStatus?(updateFlowData(DataforMap[index].code),clearFlows(),clearFlowLegend(),updateLegend(DataforMap[index],"flows"),window.maxBubble=DataforMap[index].max):updateLegend(DataforMap[index],"size")})}else{var shapes=[],layerGroup=[],mapSubPoints=getMapSubPoints(mapCentroides);DataforMap.forEach(function(data,i){runOnce("createGeoJson"+i,function(){shapes[i]=L.geoJson(mapShapes,{style:getColorCountryShapesStyleGeneric(DataforMap[i]),onEachFeature:highlightAndPopup,clickable:!1}),void 0!=mapSubPoints?(bubbles[i]=L.geoJson(mapSubPoints,{pointToLayer:bubblesSimpleColorGeneric(DataforMap[i]),onEachFeature:highlightAndPopup}),layerGroup[i]=L.layerGroup([shapes[i],bubbles[i]])):layerGroup[i]=L.layerGroup([shapes[i]]),L.stamp(layerGroup[i])},function(){layerGroup[i].eachLayer(function(feature){feature.setStyle(getColorCountryShapesStyleGeneric(DataforMap[i]))})}),layerName[$("<div>").html(DataforMap[i].title).text()]=layerGroup[i]}),runOnce("addDefaultLayer",function(){layerGroup[DataforMapAll.defaultLayer].addTo(mapdataviz),DataforMap.length>1&&($(window).width()<750||2==embed?L.control.layers(layerName,null,{collapsed:!0}).addTo(mapdataviz):L.control.layers(layerName,null,{collapsed:!1}).addTo(mapdataviz))}),$(".leaflet-control-layers-selector").click(mobx.action("layer",function(){var index=$(this).parent().index();DataforMapAll.defaultLayer=index})),mobx.autorun(function(){updateLegend(DataforMap[DataforMapAll.defaultLayer],"color")},{name:"updateLegend"})}}function runOnce(name,f1,f2){mobx.autorun(function(done){return function(reaction){done?f2&&f2():(done=!0,f1(),f2||reaction.dispose())}}(!1),{name:name})}function textColor(hex){var match=hex.match(/^#(..)(..)(..)$/);if(match){var rgb=match.slice(1).map(function(s){return parseInt(s,16)/255});return(Math.min.apply(null,rgb)+Math.max.apply(null,rgb))/2<.5?"#fff":"#000"}return"#000"}function updateLegend(Data,mode){function playStart(){var button=$("div.sliderWrapper input");window.clearInterval(button.data("timer")),button.data("timer",0),button.val(STOP),button.data("timer",window.setInterval(playStep,1e3)),playStep(0)}function playStop(){var button=$("div.sliderWrapper input");button.val(PLAY),window.clearInterval(button.data("timer")),button.data("timer",0)}function playStep(pos){var el=$('div[name="sliderMapColor"]'),options=el.slider("option");"number"!=typeof pos&&(pos=el.slider("value")+1),pos>options.max?playStop():el.slider("value",pos)}if("color"==mode)if(Data){var colors=Data.colors;$("#legendMinColor").parent().parent().empty().append(colors.map(function(color,idx,colors){var el=$("<li>");return 0===idx?(el.addClass("firstLegendElement"),el.append($('<span id="legendMinColor" class="firstLegendElement">').css("background",color).css("color",textColor(color)))):idx+1===colors.length?(el.addClass("lastLegendElement"),el.append($('<span id="legendMaxColor" class="lastLegendElement">').css("background",color).css("color",textColor(color)))):el.append($("<span>").css("background",color)),el})),$("#legendMaxColor").html(getHumanReadData(Data.max,Data.options.tooltipDecimals)),$("#legendMinColor").html(getHumanReadData(Data.min,Data.options.tooltipDecimals)),$("#legendTitleColor").text($("<div>").html(Data.title).text());var sliderHeight=null!==Data.selectedYear?23:0;if("mapRegion"in Data.options&&""!=Data.options.mapRegion&&Data.values[Data.options.mapRegion]){var subtext=lang_countries[Data.options.mapRegion.toLowerCase()]+": "+getHumanReadData(Data.values[Data.options.mapRegion][1],Data.options.tooltipDecimals);""!=Data.options.tooltipUnit&&(subtext+=" "+Data.options.tooltipUnit),Data.values[Data.options.mapRegion][0]!=Data.latestYear&&(subtext+=" ("+Data.values[Data.options.mapRegion][0]+")"),$("#legendSubtextColor").html(subtext),$("#legendSubtextColor").show(),"mapSource"in lang_labels?$("#topContainer").css("height",66+sliderHeight):$("#topContainer").css("height",58+sliderHeight)}else"mapSource"in lang_labels&&$("#topContainer").css("height",58+sliderHeight),$("#legendSubtextColor").hide();window.relatedDataControl&&window.relatedDataControl.updateColors(function(id){return Data.values[id]&&quantize(Data.values[id][1],Data.min,Data.max,Data.colors)}),""!=Data.options.tooltipUnit?$("#legendUnitColor").text(", "+Data.options.tooltipUnit):$("#legendUnitColor").text(""),$("#legendYearColor").text(Data.latestYear);var sliderCreated=void 0!==$('div[name="sliderMapColor"]').slider("instance");if(null!==Data.selectedYear){$("div.sliderWrapper").show();var PLAY="▶",STOP="◾";sliderCreated||($('div[name="sliderMapColor"]').slider({max:1,disabled:!0}),$("div.sliderWrapper input").val(PLAY),$("div.sliderWrapper input").off("click").click(function(){$(this).val()!==PLAY?playStop():playStart()})),$('div[name="sliderMapColor"]').slider("option",{start:function(){playStop()},change:mobx.action("slider",function(ev,ui){ev.originalTarget&&playStop(),Data.selectedYear=Data.years[ui.value]})}),$('div[name="sliderMapColor"]').slider("option",{max:Data.years.length-1,value:(Data.years.length+Data.years.indexOf(Data.selectedYear))%Data.years.length,disabled:!1})}else sliderCreated&&$('div[name="sliderMapColor"]').slider("destroy"),$("div.sliderWrapper").hide()}else $("#legendMaxColor").html(""),$("#legendMinColor").html(""),$("#legendTitleColor").text("No data available"),$("#legendUnitColor").text(""),$("#legendYearColor").text("");else"flows"==mode?Data?($("#legendBubble").html(window.lang_labels.min+": "+getHumanReadData(Data.min,Data.options.tooltipDecimals)+" - "+window.lang_labels.max+": "+getHumanReadData(Data.max,Data.options.tooltipDecimals)),$("#legendTitleSize").text($("<div>").html(Data.title).text()),""!=Data.options.tooltipUnit?$("#legendUnitSize").text(", "+Data.options.tooltipUnit):$("#legendUnitSize").text(""),$("#legendYearSize").text("")):($("#legendBubble").html(""),$("#legendTitleSize").text("No data available"),$("#legendUnitSize").text(""),$("#legendYearSize").text("")):Data?($("#legendBubble").html(window.lang_labels.min+": "+getHumanReadData(Data.min,Data.options.tooltipDecimals)+" - "+window.lang_labels.max+": "+getHumanReadData(Data.max,Data.options.tooltipDecimals)),$("#legendTitleSize").text($("<div>").html(Data.title).text()),""!=Data.options.tooltipUnit?$("#legendUnitSize").text(", "+Data.options.tooltipUnit):$("#legendUnitSize").text(""),$("#legendYearSize").text(Data.latestYear)):($("#legendBubble").html(""),$("#legendTitleSize").text("No data available"),$("#legendUnitSize").text(""),$("#legendYearSize").text(""));$("#flowLayer .commodity").text(Data.title)}function updateMultiLegend(Data,mode){"color"==mode?Data?($("#legendMaxColor").html(getHumanReadData(Data.max,Data.options.tooltipDecimals)),$("#legendMinColor").html(getHumanReadData(Data.min,Data.options.tooltipDecimals)),$("#legendTitleColor").text($("<div>").html(Data.title).text()),""!=Data.options.tooltipUnit?$("#legendUnitColor").text(", "+Data.unit):$("#legendUnitColor").text(""),$("#legendYearColor").text("")):($("#legendMaxColor").html(""),$("#legendMinColor").html(""),$("#legendTitleColor").text("No data available"),$("#legendUnitColor").text(""),$("#legendYearColor").text("")):Data?($("#legendBubble").html(window.lang_labels.min+": "+getHumanReadData(Data.min,Data.options.tooltipDecimals)+" - "+window.lang_labels.max+": "+getHumanReadData(Data.max,Data.options.tooltipDecimals)),$("#legendTitleSize").text($("<div>").html(Data.title).text()),""!=Data.options.tooltipUnit?$("#legendUnitSize").text(", "+Data.unit):$("#legendUnitSize").text(""),$("#legendYearColor").text("")):($("#legendBubble").html(""),$("#legendTitleSize").text("No data available"),$("#legendUnitSize").text(""),$("#legendYearSize").text(""))}function setLegend(chartType,bubbleMap){"colored"==bubbleMap||"multiColored"==bubbleMap||"coloredPairUnpair"==bubbleMap?$("#textLegend").hide():"simple"==bubbleMap?($("#colorLegend").hide(),"mapWizard"==chartType&&($("#textLegend").hide(),$("#sizeLegend").css({width:"100%"}))):($("#sizeLegend").hide(),"mapWizard"==chartType&&($("#textLegend").hide(),$("#colorLegend").css({width:"100%"})))}function getColorCountryShapesStyleGeneric(layerData){return function(feature){return feature&&feature.properties&&null!=layerData.values[feature.properties[mapCode]]?{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:getIndicatorColorScale(layerData.values[feature.properties[mapCode]][1],layerData.min,layerData.max,feature,layerData.colors)||landmassNA,className:"hasValue"}:feature&&feature.properties&&$.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1?{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:landmassNA,className:"hasValue"}:feature&&feature.properties&&$.inArray(feature.properties[mapCode].toString().toLowerCase(),["aut","bel","cyp","deu","esp","est","fin","fra","grc","hrv","irl","ita","ltu","lux","lva","mlt","nld","prt","svk","svn"])>-1?{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:"#004996",className:"hasValue"}:feature&&feature.properties&&feature.properties[mapCode]?{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:landmass,className:"hasValue"}:{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:landmassGroup,className:"hasValue"}}}function bubblesSimpleGeneric(Data){return function(feature,latlng){return L.circleMarker(latlng,getBubbleStyleGeneric(feature,Data))}}function bubblesSimpleColorGeneric(colorData){return function(feature,latlng){return L.circleMarker(latlng,getBubbleColorGeneric(feature,colorData))}}function bubblesSizeColorGeneric(sizeData,colorData){return function(feature,latlng){return L.circleMarker(latlng,getBubbleSizeColorGeneric(feature,sizeData,colorData))}}function getBubbleStyleGeneric(feature,layerData){var bubbleColor;if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1&&null!=layerData.values[feature.properties[mapCode]]&&(bubbleColor=bubbleDefaultColor,null!=layerData.values[feature.properties[mapCode]])){var radius=getBubbleSize(layerData.values[feature.properties[mapCode]][1],layerData.max,feature);if(null!=radius)return{radius:radius,fillColor:bubbleColor,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}return{radius:0,opacity:0}}function getBubbleSizeColorGeneric(feature,sizeData,colorData){var bubbleColor;if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1&&null!=sizeData.values[feature.properties[mapCode]])if(radius=getBubbleSize(sizeData.values[feature.properties[mapCode]][1],sizeData.max,feature),null!=colorData){if(null!=colorData.values[feature.properties[mapCode]]){var bubbleColor=getIndicatorColorScale(colorData.values[feature.properties[mapCode]][1],colorData.min,colorData.max,feature,colorData.colors);if(null!=radius)return{radius:radius,fillColor:bubbleColor,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}}else if(null!=radius)return{radius:radius,fillColor:bubbleDefaultBorder,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1};return{radius:0,opacity:0}}function getBubbleColorGeneric(feature,colorData){var bubbleColor;if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1&&(radius=5,null!=colorData.values[feature.properties[mapCode]])){var bubbleColor=getIndicatorColorScale(colorData.values[feature.properties[mapCode]][1],colorData.min,colorData.max,feature,colorData.colors);if(null!=radius)return{radius:radius,fillColor:bubbleColor,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}return{radius:0,opacity:0}}function getBasicCountryShapesStyle(feature){return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:function(feature){return $.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1?landmassGroup:landmass}(feature)}}function clickFlow(e){var layer=e.target,layerCode=layer.feature.properties[mapCode],color=["blue","blue","blue"];clearFlows(),activeLayer!=layerCode&&$.inArray(layerCode.toLowerCase(),MapGroup)>-1?(addLines({center:layerCode,stars:getFlows(layerCode)},color[colorIdx],centroides,mapdataviz),colorIdx=(colorIdx+1)%3,activeLayer=layerCode,updateFlowLegend(layerCode)):activeLayer=""}function clearFlows(){flowGroup.clearLayers().addTo(mapdataviz)}function getFlows(country){function getLineSize(d,max){return null==d||d<=0?null:25*Math.sqrt(d/max)}var data=window.DataforFlow,idxCountry=data.keys[0].indexOf(country.toUpperCase()),newData={},max=0;return $.each(data.keys[1],function(key,value){var crData=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];max<crData&&(max=crData)}),$.each(data.keys[1],function(key,value){var crData1=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];newData[value]=crData1/max>.01?getLineSize(crData1,window.maxBubble):0}),newData}function clearFlowLegend(){$("#flowLayer .helptext").show(),$("#flowLayer #detailsTable").hide(),$("#flowLayer .countryPrefix").text(""),$("#flowLayer .country").html("")}function updateFlowLegend(layerCode){var flowLabels={tableHead1:{en:"Main export destinations",cn:"主要出口目的地"},tableHead2:{en:"USD Millions",cn:"百万美元"},world:{en:"World",cn:"世界"},unspecified:{en:"unspecified",cn:"未标明"},asia:{en:"Asia n.e.s.",cn:"亚洲n.e.s."},headlinePrefix:{en:"Exports from ",cn:"从"},headlineSuffix:{en:"",cn:"的出口"}};null!=window.lang_countries[layerCode.toLowerCase()]?$("#flowLayer .country").html(window.lang_countries[layerCode.toLowerCase()]):$("#flowLayer .country").html(layerCode),$("#flowLayer #countryPrefix").text(flowLabels.headlinePrefix[lang]),$("#flowLayer #countrySuffix").text(flowLabels.headlineSuffix[lang]),$("#flowLayer .helptext").hide(),$("#flowLayer #detailsTable").show(),$("#flowLayer #detailsTable thead .countries").text(flowLabels.tableHead1[lang]),$("#flowLayer #detailsTable thead .values").text(flowLabels.tableHead2[lang]),$("#flowLayer #detailsTable tbody").remove(),$("#flowLayer #detailsTable").append("<tbody>");var legendData=function(country){var data=window.DataforFlow,idxCountry=data.keys[0].indexOf(country.toUpperCase()),newData={};newData.rank=[],newData.values={};var max=0;return $.each(data.keys[1],function(key,value){var crData=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];max<crData&&(max=crData)}),$.each(data.keys[1],function(key,value){var crData1=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];crData1/max>.01&&(newData.values[crData1]=value,newData.rank.push(crData1))}),newData.rank.sort(function(a,b){return b-a}),newData}(layerCode);$.each(legendData.rank,function(key,value){null!=window.lang_countries[legendData.values[value].toLowerCase()]?country=window.lang_countries[legendData.values[value].toLowerCase()]:"WLD"==legendData.values[value]?country=flowLabels.world[lang]:"UNSPE"==legendData.values[value]?country=flowLabels.unspecified[lang]:"XCD"==legendData.values[value]?country=flowLabels.asia[lang]:country=legendData.values[value],$("#flowLayer #detailsTable tbody").append("<tr><td>"+country+'</td><td  class="tableValues">'+Math.round(value/1e6)+"</td>")})}function addLines(flow,color,centros,mapdataviz){var stars={};$.each(flow.stars,function(country,value){void 0!=centros[country.toUpperCase()]&&(stars[country]={},stars[country].latlong=[parseFloat(centros[country.toUpperCase()].Lat),parseFloat(centros[country.toUpperCase()].Long)],stars[country].value=value)});var center=[parseFloat(centros[flow.center.toUpperCase()].Lat),parseFloat(centros[flow.center.toUpperCase()].Long)];$.each(stars,function(country,values){var lines=L.polyline([center,values.latlong],{color:color,weight:values.value,fill:"blue"});flowGroup.addLayer(lines)})}function updateFlowData(indicator){function ajaxSuccess(data){null!=data?window.DataforFlow=data:alert("No data available.")}$.ajax({dataType:"json",url:baseURL+"/api-data?project="+project+"&id="+indicator,success:ajaxSuccess,error:function(xhr,ajaxOptions,thrownError){"404"==xhr.status&&alert("No data available.")}})}function highlightAndPopup(feature,layer){if(feature&&feature.properties&&feature.properties[mapCode]){var interaction;interaction="flow"==window.flowStatus?clickFlow:highlightAndPopupClick;var inEuroArea=feature&&feature.properties&&$.inArray(feature.properties[mapCode].toString().toLowerCase(),["aut","bel","cyp","deu","esp","est","fin","fra","grc","hrv","irl","ita","ltu","lux","lva","mlt","nld","prt","svk","svn"])>-1;("ecb"==themeURL&&!inEuroArea||$.inArray(layer.feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1)&&(layer.on({click:interaction,mouseover:function(){layer.inFront||(layer.inFront=!0,layer.setStyle({fillOpacity:.8,weight:2,color:null!=bubbleMap?bubbleHighlightBorder:shapeHighlightBorder}).bringToFront())},mouseout:function(){layer.inFront=!1,layer.setStyle({fillOpacity:1,weight:landmassBorderWidth,color:null!=bubbleMap?bubbleDefaultBorder:landmassBorder}),"undefined"!=typeof disputedLines&&disputedLines.bringToFront(),void 0!==flowGroup&&flowGroup.eachLayer(function(layer){layer.bringToFront?layer.bringToFront():layer.eachLayer(function(sublayer){sublayer.bringToFront()})})}}),layer.eachLayer?layer.eachLayer(function(sublayer){L.Util.setOptions(sublayer,{clickable:!0})}):L.Util.setOptions(layer,{clickable:!0}))}}function mapTeaserExportRestrictions(country){var labels2={};labels2.en={1:"export prohibition",2:"export quota",3:"export tax",4:"non-automatic licencing",5:"other measures",6:"no restrictions",undefined:"not reseached"},labels2.cn={1:"禁止出口",2:"出口配额",3:"出口税",4:"非自动许可",5:"其他措施",6:"无限制",undefined:"没有研究"};var tableLines,countryProfile="<div class='countryProfilLink'><span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span></div>",countryName=lang_countries[country.toLowerCase()]+" - "+DataforMap[mapLayerIndex].title,tableLine=[];return DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]?(tableLine[0]="<tr><td>"+DataforMap[mapLayerIndex].options.tooltipUnit+":</td><td class='tooltipData'>"+getHumanReadData(DataforMap[mapLayerIndex].values[country][1])+" "+DataforMap[mapLayerIndex].unit+"</td></tr>",tableLine[1]="<tr><td>"+DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1].options.tooltipUnit+":</td><td class='tooltipData'>"+labels2[lang][DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1].values[country][1]]+"</td></tr>"):(tableLine[0]="<tr><td>"+DataforMap[mapLayerIndex].options.tooltipUnit+":</td><td class='tooltipData'>"+labels2[lang][DataforMap[mapLayerIndex].values[country][1]]+"</td></tr>",tableLine[1]="<tr><td></td><td></td></tr>"),tableLines=tableLine[0]+tableLine[1],'<h3 class="tooltipTitle">'+countryName+'</h3><table class="tooltipTable">'+tableLines+"</td></tr></table>"+countryProfile}
function mapTeaserExportRestrictionsMain(country){var labels2={};labels2.en={1:"export prohibition",2:"export quota",3:"export tax",4:"non-automatic licencing",5:"other measures",6:"no restrictions",undefined:"not reseached"},labels2.cn={1:"禁止出口",2:"出口配额",3:"出口税",4:"非自动许可",5:"其他措施",6:"无限制",undefined:"没有研究"};var tableLines,countryProfile="<div class='countryProfilLink'><span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span></div>",countryName=lang_countries[country.toLowerCase()],tableLineCanvas=[],tooltipData=[];return tableLineCanvas[0]="<tr><td title='"+DataforMap[0].definition+"'>"+DataforMap[0].title+":</td><td class='tooltipData'>",tooltipData[0]=labels2[lang][DataforMap[0].values[country][1]],tableLines=tableLineCanvas[0]+tooltipData[0],'<h3 class="tooltipTitle">'+countryName+'</h3><table class="tooltipTable">'+tableLines+"</td></tr></table>"+countryProfile}function mapTeaserIfiCountryData(country,links){var teaser=$("<div>"),teaserTitle=$('<h3 class="tooltipTitle">'),teaserTable=$('<table class="tooltipTable">');teaser.append(teaserTitle);var link=links[country.toString().toLowerCase()];if(null!=link){var countryProfile=$('<div style="text-align: center;">').append($('<a target="_blank">').attr("href",link).text(lang_labels.countryProfile));teaser.append(countryProfile)}var countryName=lang_countries[country.toString().toLowerCase()]||country;teaserTitle.text(countryName);for(var tableLineCanvas,tooltipData,dataValue,unit,i=0;i<ChartsWithData;i++)null!=DataforMap[i]&&(tableLineCanvas=$("<tr>").append($("<td>").attr("title",$("<div>").html(DataforMap[i].definition).text()).html(DataforMap[i].title)),tooltipData=$('<td class="tooltipData">'),tableLineCanvas.append(tooltipData),void 0!=DataforMap[i].values[country]&&null!=DataforMap[i].values[country][1]?(!0,dataValue=getHumanReadData(DataforMap[i].values[country][1],DataforMap[i].options.tooltipDecimals),unit=DataforMap[i].options.tooltipUnit||"",""!==unit&&(dataValue+="&nbsp;"+unit),DataforMap[i].values[country][0]!=DataforMap[i].latestYear&&(dataValue+="&nbsp;("+DataforMap[i].values[country][0]+")"),tooltipData.html(dataValue)):tooltipData.text("—"),teaserTable.append(tableLineCanvas));return teaserTitle.after(teaserTable),teaser[0]}function mapTeaserText(country){var euGroup=["aut","bel","bgr","cyp","deu","dnk","esp","fin","fra","gbr","grc","hrv","irl","ita","lux","lva","ltu","mlt","nld","prt","swe","cze","est","hun","pol","svk","svn","rou"],teaser=$("<div>"),teaserTitle=$('<h3 class="tooltipTitle">'),teaserTable=$('<table class="tooltipTable">');teaser.append(teaserTitle);var countryProfile=$('<div class="countryProfilLink">').append($('<span id="countryProfileMap">').attr("value",country).html(lang_labels.countryProfile));"undefined"!=typeof wizardConfig&&"withEU"==wizardConfig.tabs[wizardConfig.project.tabs[page]].countrynotes&&$.inArray(country.toString().toLowerCase(),euGroup)>-1&&countryProfile.append('<span value="eu" id="euProfileMap">view EU profile</span>'),teaser.append(countryProfile);var countryName=lang_countries[country.toString().toLowerCase()]||ISO3toFlags[country]||country;teaserTitle.text(countryName);for(var tableLineCanvas,tooltipData,dataValue,hasData=!1,i=0;i<ChartsWithData;i++)null!=DataforMap[i]&&(tableLineCanvas=$("<tr>").append($("<td>").attr("title",$("<div>").html(DataforMap[i].definition).text()).html(DataforMap[i].title)),tooltipData=$('<td class="tooltipData">'),tableLineCanvas.append(tooltipData),void 0!=DataforMap[i].values[country]&&null!=DataforMap[i].values[country][1]?(hasData=!0,dataValue=getHumanReadData(DataforMap[i].values[country][1],DataforMap[i].options.tooltipDecimals)+"&nbsp;"+DataforMap[i].options.tooltipUnit,DataforMap[i].values[country][0]!=DataforMap[i].latestYear&&(dataValue+="&nbsp;("+DataforMap[i].values[country][0]+")"),tooltipData.html(dataValue)):tooltipData.text("—"),teaserTable.append(tableLineCanvas));return(hasData||"ecb"!=themeURL)&&teaserTitle.after(teaserTable),teaser[0]}function mapTeaserTextMulti(country){var euGroup=["aut","bel","bgr","cyp","deu","dnk","esp","fin","fra","gbr","grc","hrv","irl","ita","lux","lva","ltu","mlt","nld","prt","swe","cze","est","hun","pol","svk","svn","rou"];if("undefined"!=typeof wizardConfig&&"withEU"==wizardConfig.tabs[wizardConfig.project.tabs[page]].countrynotes&&$.inArray(country.toString().toLowerCase(),euGroup)>-1)var countryProfile="<div class='countryProfilLink'><span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span><span value='eu' id='euProfileMap' >view EU profile</span></div>";else var countryProfile="<div class='countryProfilLink'><span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span></div>";if(null!=lang_countries[country.toString().toLowerCase()])var countryName=lang_countries[country.toString().toLowerCase()]+" - "+DataforMap[mapLayerIndex].title;else var countryName=country+" - "+DataforMap[mapLayerIndex].title;var tableLines,tableLine=[];return tableLine[0]="<tr><td>"+DataforMap[mapLayerIndex].options.tooltipUnit+"</td><td class='tooltipData'>"+getHumanReadData(DataforMap[mapLayerIndex].values[country][1])+"</td></tr>",DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]?tableLine[1]="<tr><td>"+DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1].options.tooltipUnit+"</td><td class='tooltipData'>"+getHumanReadData(DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1].values[country][1])+"</td></tr>":tableLine[1]="<tr><td></td><td></td></tr>",tableLines=tableLine[0]+tableLine[1],'<h3 class="tooltipTitle">'+countryName+'</h3><table class="tooltipTable">'+tableLines+"</td></tr></table>"+countryProfile}var landmass,landmassBorder,landmassBorderWidth,landmassGroup,bubbleDefaultBorder,bubbleDefaultColor,bubbleHighlightBorder,shapeHighlightBorder;"ecb"==themeURL?(landmass="#f0f0f0",landmassNA="#fff",landmassBorder="#000",landmassBorderWidth=.5,landmassGroup="#f0f0f0",bubbleDefaultBorder="#494444",bubbleDefaultColor="#d56620",bubbleHighlightBorder="#fff",shapeHighlightBorder="#fff"):(landmass="#939393",landmassNA="#939393",landmassBorder="#939393",landmassBorderWidth=1,landmassGroup="#BBBBBB",bubbleDefaultBorder="#494444",bubbleDefaultColor="#d56620",bubbleHighlightBorder="#fff",shapeHighlightBorder="#fff"),"trade-in-raw-materials"==project&&(landmass="#BBBBBB",landmassNA="#BBBBBB"),"itf-test"==project&&(landmass="#BBBBBB",landmassNA="#BBBBBB");var colorIdx=0,flowGroup=L.layerGroup(),activeLayer="";L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI+90},getPointPathPixelLength:function(a){var b=a.length;if(2>b)return 0;for(var c=0,d=a[0],e=1;e<b;e++)c+=d.distanceTo(d=a[e]);return c},getPixelLength:function(a,b){var c=a instanceof L.Polyline?a.getLatLngs():a,d=c.length;if(2>d)return 0;for(var e=0,f=b.project(c[0]),g=1;g<d;g++)e+=f.distanceTo(f=b.project(c[g]));return e},projectPatternOnPath:function(a,b,c,d){var f,e=[];for(f=0,l=a.length;f<l;f++)e[f]=d.project(a[f]);for(a=this.projectPatternOnPointPath(e,b,c),f=0,l=a.length;f<l;f++)a[f].latLng=d.unproject(a[f].pt);return a},projectPatternOnPointPath:function(a,b,c){var d=[],e=this.getPointPathPixelLength(a)*c;if(b=this.interpolateOnPointPath(a,b),d.push(b),0<c)for(a=a.slice(b.predecessor),a[0]=b.pt,c=this.getPointPathPixelLength(a);e<=c;)b=this.interpolateOnPointPath(a,e/c),d.push(b),a=a.slice(b.predecessor),a[0]=b.pt,c=this.getPointPathPixelLength(a);return d},interpolateOnPointPath:function(a,b){var c=a.length;if(2>c)return null;if(0>=b)return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])};if(1<=b)return{pt:a[c-1],predecessor:c-1,heading:this.computeAngle(a[c-2],a[c-1])};if(2==c)return{pt:this.interpolateBetweenPoints(a[0],a[1],b),predecessor:0,heading:this.computeAngle(a[0],a[1])};for(var d=this.getPointPathPixelLength(a),e=a[0],f=e,g=0,h=0,k=0,j=1;j<c&&h<b;j++)e=f,g=h,f=a[j],k+=e.distanceTo(f),h=k/d;return{pt:this.interpolateBetweenPoints(e,f,(b-g)/(h-g)),predecessor:j-2,heading:this.computeAngle(e,f)}},interpolateBetweenPoints:function(a,b,c){return b.x!=a.x?new L.Point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y):new L.Point(a.x,a.y+(b.y-a.y)*c)}},L.RotatedMarker=L.Marker.extend({options:{angle:0},_setPos:function(a){if(L.Marker.prototype._setPos.call(this,a),L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var b=this.options.angle*L.LatLng.DEG_TO_RAD;a=Math.cos(b),b=Math.sin(b),this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+a+", M12="+-b+", M21="+b+", M22="+a+")"}}}),L.rotatedMarker=function(a,b){return new L.RotatedMarker(a,b)},L.Symbol=L.Symbol||{},L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c){if(b=this.options,1>=b.pixelSize)return new L.Polyline([a.latLng,a.latLng],b.pathOptions);var d=c.project(a.latLng);return a=-(a.heading-90)*L.LatLng.DEG_TO_RAD,a=new L.Point(d.x+b.pixelSize*Math.cos(a+Math.PI)/2,d.y+b.pixelSize*Math.sin(a)/2),d=d.add(d.subtract(a)),new L.Polyline([c.unproject(a),c.unproject(d)],b.pathOptions)}}),L.Symbol.dash=function(a){return new L.Symbol.Dash(a)},L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(a){L.Util.setOptions(this,a),this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c){return b=this.options,b.polygon?new L.Polygon(this._buildArrowPath(a,c),b.pathOptions):new L.Polyline(this._buildArrowPath(a,c),b.pathOptions)},_buildArrowPath:function(a,b){var c=b.project(a.latLng),d=-(a.heading-90)*L.LatLng.DEG_TO_RAD,e=this.options.headAngle/2*L.LatLng.DEG_TO_RAD,f=d+e,d=d-e,f=new L.Point(c.x-this.options.pixelSize*Math.cos(f),c.y+this.options.pixelSize*Math.sin(f)),c=new L.Point(c.x-this.options.pixelSize*Math.cos(d),c.y+this.options.pixelSize*Math.sin(d));return[b.unproject(f),a.latLng,b.unproject(c)]}}),L.Symbol.arrowHead=function(a){return new L.Symbol.ArrowHead(a)},L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(a){L.Util.setOptions(this,a),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1,this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(a){return this.options.rotate?(this.options.markerOptions.angle=a.heading,new L.RotatedMarker(a.latLng,this.options.markerOptions)):new L.Marker(a.latLng,this.options.markerOptions)}}),L.Symbol.marker=function(a){return new L.Symbol.Marker(a)},L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(a,b){L.LayerGroup.prototype.initialize.call(this),L.Util.setOptions(this,b),this._map=null,this._initPaths(a),this._initPatterns()},_initPaths:function(a){this._paths=[];var b=!1;if(a instanceof L.MultiPolyline||(b=a instanceof L.MultiPolygon)){a=a.getLatLngs();for(var c=0;c<a.length;c++)this._initPath(a[c],b)}else if(a instanceof L.Polyline)this._initPath(a.getLatLngs(),a instanceof L.Polygon);else if(L.Util.isArray(a)&&0<a.length)if(a[0]instanceof L.Polyline)for(c=0;c<a.length;c++)this._initPath(a[c].getLatLngs(),a[c]instanceof L.Polygon);else this._initPath(a)},_isCoordArray:function(a){return L.Util.isArray(a)&&0<a.length&&(a[0]instanceof L.LatLng||L.Util.isArray(a[0])&&2==a[0].length&&"number"==typeof a[0][0])},_initPath:function(a,b){var c;c=this._isCoordArray(a)?[a]:a;for(var d=0;d<c.length;d++)b&&c[d].push(c[d][0]),this._paths.push(c[d])},_initPatterns:function(){this._isZoomDependant=!1,this._patterns=[];for(var a,b=0;b<this.options.patterns.length;b++)a=this._parsePatternDef(this.options.patterns[b]),this._patterns.push(a),this._isZoomDependant=this._isZoomDependant||a.isOffsetInPixels||a.isRepeatInPixels||a.symbolFactory.isZoomDependant},setPatterns:function(a){this.options.patterns=a,this._initPatterns(),this._softRedraw()},setPaths:function(a){this._initPaths(a),this.redraw()},_parsePatternDef:function(a){var b={cache:[],symbolFactory:a.symbol,isOffsetInPixels:!1,isRepeatInPixels:!1};return"string"==typeof a.offset&&-1!=a.offset.indexOf("%")?b.offset=parseFloat(a.offset)/100:(b.offset=parseFloat(a.offset),b.isOffsetInPixels=0<b.offset),"string"==typeof a.repeat&&-1!=a.repeat.indexOf("%")?b.repeat=parseFloat(a.repeat)/100:(b.repeat=parseFloat(a.repeat),b.isRepeatInPixels=0<b.repeat),b},onAdd:function(a){this._map=a,this._draw(),this._isZoomDependant&&this._map.on("zoomend",this._softRedraw,this)},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this),this._map=null,L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,b,c){for(var d=[],e=0,f=c.length;e<f;e++)d.push(b.buildSymbol(c[e],a,this._map,e,f));return d},_getCache:function(a,b,c){var d=a.cache[b];return void 0===d?(a.cache[b]=[],null):d[c]},_getDirectionPoints:function(a,b){var c=this._map.getZoom(),d=this._getCache(b,c,a);if(d)return d;var e;e=null;var f=this._paths[a];return b.isOffsetInPixels?(e=L.LineUtil.PolylineDecorator.getPixelLength(f,this._map),d=b.offset/e):d=b.offset,b.isRepeatInPixels?(e=null!==e?e:L.LineUtil.PolylineDecorator.getPixelLength(f,this._map),e=b.repeat/e):e=b.repeat,d=L.LineUtil.PolylineDecorator.projectPatternOnPath(f,d,e,this._map),b.cache[c][a]=d},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(a){if(null!==this._map){if(this.clearLayers(),a)for(a=0;a<this._patterns.length;a++)this._patterns[a].cache=[];this._draw()}},_drawPattern:function(a){for(var b,c=0;c<this._paths.length;c++){b=this._getDirectionPoints(c,a),b=this._buildSymbols(this._paths[c],a.symbolFactory,b);for(var d=0;d<b.length;d++)this.addLayer(b[d])}},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}}),L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)};var highlightAndPopupClick=function(disposer){return function(e){var layer=e.target;disposer&&disposer(),disposer=mobx.autorun(function(){var teaserText,specialTooltip=window.wizardConfig.tabs[wizardConfig.project.tabs[page]].specialTooltip,specialTooltipLinks=window.wizardConfig.tabs[wizardConfig.project.tabs[page]].specialTooltipLinks;teaserText="export-restrictions-main"==specialTooltip?mapTeaserExportRestrictionsMain(layer.feature.properties[mapCode]):"export-restrictions"==specialTooltip?mapTeaserExportRestrictions(layer.feature.properties[mapCode]):"ifi-country-data"==specialTooltip?mapTeaserIfiCountryData(layer.feature.properties[mapCode],specialTooltipLinks):"multiColored"==window.bubbleMap?mapTeaserTextMulti(layer.feature.properties[mapCode]):mapTeaserText(layer.feature.properties[mapCode]),("ecb"==themeURL||$.inArray(layer.feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1)&&popup.setContent(teaserText)},{name:"map.click"}),("ecb"==themeURL||$.inArray(layer.feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1)&&(popup.setLatLng(e.latlng),popup.openOn(mapdataviz))}}();
//# sourceMappingURL=mapWizardSimple.js.map