function getHumanReadData(number,decimals,trimZeros){if(decimals===undefined){decimals=0}if(decimals<0){return number}number=parseFloat(number);var abs=Math.abs(number);function decimalAdjust(type,value,exp){if(typeof exp==="undefined"||+exp===0){return Math[type](value)}value=+value;exp=+exp;if(isNaN(value)||!(typeof exp==="number"&&exp%1===0)){return NaN}value=value.toString().split("e");value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))}function toFixed(number,decimals){var s=decimalAdjust("round",number,-decimals).toFixed(decimals);return trimZeros?s.replace(/\.0+$|(\..*?)0+$/,"$1"):s}function spaceSeparateNumber(val){while(/(\d+)(\d{3})/.test(val.toString())){val=val.toString().replace(/(\d+)(\d{3})/,"$1"+" "+"$2")}return val}function commaSeparateNumber(val){while(/(\d+)(\d{3})/.test(val.toString())){val=val.toString().replace(/(\d+)(\d{3})/,"$1"+","+"$2")}return val}if(abs>1e12){return toFixed(number/1e12,decimals)+"&nbsp;"+window.lang_labels["trillion"]}else if(abs>1e9){return toFixed(number/1e9,decimals)+"&nbsp;"+window.lang_labels["billion"]}else if(abs>1e6){return toFixed(number/1e6,decimals)+"&nbsp;"+window.lang_labels["million"]}else if(abs>1e5){return toFixed(number/1e3,decimals)+"&nbsp;"+window.lang_labels["thousand"]}else{return spaceSeparateNumber(toFixed(number,decimals))}}function getLatestYearData(data){var newData={};var latestYear=data.keys[1].length-1;$.each(data.keys[0],function(key,value){newData[value]=[];while(data.data[data.keys[0].indexOf(value)][latestYear]==null&&latestYear>=0){latestYear=latestYear-1}newData[value][0]=data.keys[1][latestYear];newData[value][1]=data.data[data.keys[0].indexOf(value)][latestYear];latestYear=data.keys[1].length-1});return newData}function filterYear(d,filter){var newData={};newData["title"]=d.title;newData["definition"]=d.definition;newData["options"]=d.options;newData["data"]={};newData.data["dimensions"]=d.data.dimensions;newData.data["keys"]=[];newData.data["keys"][0]=d.data.keys[0];newData.data["keys"][1]=[];newData.data["data"]=[];var idxYear=[];$.each(filter,function(key,value){idxYear.push(d.data.keys[1].indexOf(value));newData.data.keys[1].push(value)});$.each(newData.data.keys[0],function(key,cr){newData.data.data[key]=[];$.each(idxYear,function(yKey,value){newData.data.data[key].push(d.data.data[key][value])})});return newData}function getMapData(wizardConfig,page,countrylist,Chart){var tab=wizardConfig.project.tabs[page];var mapType=wizardConfig.tabs[tab].mapType;var flowStatus=wizardConfig.tabs[tab].type;var ConfigProject=getPageCharts(wizardConfig,page);var DataforMap=[];var DataforMap1=[];var data={};data["defaultLayer"]=0;if(Chart!=null){data["defaultLayer"]=Math.max(0,wizardConfig.tabs[tab].charts.indexOf(Chart[0]))}if(mapType=="TwoIndicatorsSplitOnYears"){var labels=wizardConfig.tabs[tab].labels;var key=0;$.each(labels.order,function(order,value){if($.inArray(value,ConfigProject[0].data.keys[1])>-1){DataforMap[key]=filterYear(ConfigProject[0],[value]);if(labels.labels[value]){DataforMap[key]["title"]=labels.labels[value].name;DataforMap[key]["unit"]=labels.labels[value].unit}else{DataforMap[key]["title"]=value;DataforMap[key]["unit"]=""}DataforMap[key]["code"]=value;DataforMap[key]["definition"]=value;DataforMap[key]["values"]=getCountryData(getLatestYearData(DataforMap[key]["data"]),countrylist);if(ConfigProject[0].options.minimum&&ConfigProject[0].options.minimum!=null){DataforMap[key]["min"]=ConfigProject[0].options.minimum}else{DataforMap[key]["min"]=minValueLatest(DataforMap[key]["values"])}if(ConfigProject[0].options.maximum&&ConfigProject[0].options.maximum!=null){DataforMap[key]["max"]=ConfigProject[0].options.maximum}else{DataforMap[key]["max"]=maxValueLatest(DataforMap[key]["values"],1)}DataforMap[key]["latestYear"]=maxValueLatest(DataforMap[key]["values"],0);key++}});if(ConfigProject[1]!=null){$.each(ConfigProject[1].data.keys[1],function(key,value){DataforMap1[key]=filterYear(ConfigProject[1],[value]);if(labels.labels[value]){DataforMap1[key]["title"]=labels.labels[value].name}else{DataforMap1[key]["title"]=value}DataforMap1[key]["code"]=value;DataforMap1[key]["definition"]=value;DataforMap1[key]["values"]=getCountryData(getLatestYearData(DataforMap1[key]["data"]),countrylist);if(ConfigProject[1].options.minimum&&ConfigProject[1].options.minimum!=null){DataforMap1[key]["min"]=ConfigProject[1].options.minimum}else{DataforMap1[key]["min"]=minValueLatest(DataforMap1[key]["values"])}if(ConfigProject[1].options.maximum&&ConfigProject[1].options.maximum!=null){DataforMap1[key]["max"]=ConfigProject[1].options.maximum}else{DataforMap1[key]["max"]=maxValueLatest(DataforMap1[key]["values"],1)}DataforMap1[key]["latestYear"]=maxValueLatest(DataforMap1[key]["values"],0)})}}else{var i=0;$.each(ConfigProject,function(chart,values){if(values.type!="flow"){DataforMap[i]={};DataforMap[i]["colors"]=MapColors;DataforMap[i]["title"]=values["title"][lang];DataforMap[i]["definition"]=values["definition"][lang];DataforMap[i]["options"]=values["options"];DataforMap[i]["values"]=getCountryData(getLatestYearData(values["data"]),countrylist);if(DataforMap[i]["options"]["minimum"]&&DataforMap[i]["options"]["minimum"]!=null){DataforMap[i]["min"]=DataforMap[i]["options"]["minimum"]}else{DataforMap[i]["min"]=minValueLatest(DataforMap[i]["values"])}if(DataforMap[i]["options"]["maximum"]&&DataforMap[i]["options"]["maximum"]!=null){DataforMap[i]["max"]=DataforMap[i]["options"]["maximum"]}else{DataforMap[i]["max"]=maxValueLatest(DataforMap[i]["values"],1)}if(DataforMap[i]["options"]["mapDivergent"]){var dMax=Math.max(Math.abs(DataforMap[i]["min"]),Math.abs(DataforMap[i]["max"]));var dMin=-dMax;var minColor=quantize(DataforMap[i]["min"],dMin,dMax,DataforMap[i]["colors"].map(function(x,idx){return idx}));var maxColor=quantize(DataforMap[i]["max"],dMin,dMax,DataforMap[i]["colors"].map(function(x,idx){return idx}));if(minColor>0){dMin+=minColor*(dMax-dMin)/DataforMap[i]["colors"].length;DataforMap[i]["colors"]=DataforMap[i]["colors"].slice(minColor)}else if(maxColor+1<DataforMap[i]["colors"].length){dMax-=(DataforMap[i]["colors"].length-(maxColor+1))*(dMax-dMin)/DataforMap[i]["colors"].length;DataforMap[i]["colors"]=DataforMap[i]["colors"].slice(0,maxColor+1)}DataforMap[i]["max"]=dMax;DataforMap[i]["min"]=dMin}DataforMap[i]["latestYear"]=maxValueLatest(DataforMap[i]["values"],0);if("mapRegion"in DataforMap[i]["options"]){DataforMap[i]["values"][DataforMap[i]["options"]["mapRegion"]]=getLatestYearData(values["data"])[DataforMap[i]["options"]["mapRegion"]]}i=i+1}})}data["map"]=DataforMap;data["map1"]=DataforMap1;data["flow"]=flowStatus;function getPageCharts(wizardConfig,page){var tab=wizardConfig.project.tabs[page];var charts=wizardConfig.tabs[tab].charts;var pageCharts=[];$.each(charts,function(k,v){pageCharts.push(wizardConfig.charts[v])});return pageCharts}function minValue(series){var min=null;$.each(series,function(k,v){if(v==null)return;if(min==null)min=v;else if(min>v)min=v});return min}function maxValue(series){var max=null;$.each(series,function(k,v){if(v==null)return;if(max==null)max=v;else if(max<v)max=v});return max}function minValueLatest(series){var min=null;$.each(series,function(k,v){v=v[1];if(v==null)return;if(min==null)min=v;else if(min>v)min=v});return min}function maxValueLatest(series,arrayValue){var max=null;$.each(series,function(k,v){v=v[arrayValue];if(v==null)return;if(max==null)max=v;else if(max<v)max=v});return max}function getStandardDeviationWizard(series,value){var devVal=[];$.each(series,function(k,v){devVal.push(v[1])});var average=getAverageFromNumArr(devVal,2);var deviation=getStandardDeviation(devVal,2);if(value=="max"){return average+deviation}if(value=="min"){return average-deviation}else{return null}}function getCountryData(series,group){var data={};$.each(series,function(k,v){if($.inArray(k,group)>-1){data[k]=v}});return data}return data}function getIndicatorColorScale(d,dMin,dMax,feature,colors){if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1){return quantize(d,dMin,dMax,colors)}else{return landmass}}function quantize(d,dMin,dMax,range){function scaleToInteger(d,dMin,dMax,scaleMin,scaleMax){var i=Math.floor((d-dMin)/(dMax-dMin)*(scaleMax-scaleMin+1))+scaleMin;if(i<scaleMin)return scaleMin;if(i>scaleMax)return scaleMax;return i}return range[scaleToInteger(d,dMin,dMax,0,range.length-1)]}function getBubbleSize(d,dMax,feature){if(d==null||d<=0)return null;var radius=Math.sqrt(d/dMax)*25;if(radius<3)radius=3;return radius}function getDisputedLines(lines,group){var disputedLinesNew={type:"FeatureCollection",features:[]};if($.inArray("ind",group)>-1||$.inArray("chn",group)>-1||$.inArray("pak",group)>-1){$.each(lines.features,function(k,feature){if(feature.properties.SOVEREIGNT=="IndiaChinaPakistan"){disputedLinesNew["features"].push(feature)}})}if($.inArray("ind",group)>-1||$.inArray("chn",group)>-1){$.each(lines.features,function(k,feature){if(feature.properties.SOVEREIGNT=="IndiaChina"){disputedLinesNew["features"].push(feature)}})}if($.inArray("egy",group)>-1||$.inArray("sdn",group)>-1){$.each(lines.features,function(k,feature){if(feature.properties.SOVEREIGNT=="EgyptSudan"){disputedLinesNew["features"].push(feature)}})}if($.inArray("sdn",group)>-1||$.inArray("ssd",group)>-1){$.each(lines.features,function(k,feature){if(feature.properties.SOVEREIGNT=="Sudan"){disputedLinesNew["features"].push(feature)}})}if($.inArray("ken",group)>-1||$.inArray("som",group)>-1){$.each(lines.features,function(k,feature){if(feature.properties.SOVEREIGNT=="KenyaSom"){disputedLinesNew["features"].push(feature)}})}return disputedLinesNew}function getMapSubPoints(mapCentroides){if(themeURL=="ecb")return;var mapSubPoints={type:"FeatureCollection",features:[]};var smallIslands=["AND","ATG","AIA","ASM","ABW","ALA","BRB","BLM","BMU","BVT","CCK","COK","CPV","CUW","CXR","DMA","FLK","FSM","GRD","GGY","GIB","GLP","SGS","GUM","HKG","IMN","JEY","KIR","COM","KNA","CYM","LCA","LIE","MCO","MAF","MHL","MAC","MNP","MTQ","MSR","MLT","MUS","MDV","NFK","NRU","NIU","PYF","SPM","PCN","PRI","PLW","REU","SYC","SHN","SJM","SMR","STP","SXM","TCA","ATF","TKL","TON","TTO","TUV","VAT","VCT","VGB","VIR","WLF","WSM","MYT","ANT"];$(mapCentroides.features).each(function(feature){if($.inArray(this.properties[mapCode],smallIslands)>-1){mapSubPoints["features"].push(this)}});return mapSubPoints}function addMapLayers(bubbleMap,mapdataviz,flowStatus){var bubbles=[];var layers={};var layerName=[];if(bubbleMap=="multiColored"){L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:false}).addTo(mapdataviz);var i=0;var matchIndex=[];$.each(DataforMap,function(key,value){$.each(DataforMap1,function(key1,value1){if(value1.title==value.title){matchIndex[key]=key1+1}});if(matchIndex[key]){var colorIndicator=DataforMap1[matchIndex[key]-1]}else{var colorIndicator=null}bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSizeColorGeneric(value,colorIndicator),onEachFeature:highlightAndPopup});layerName[$("<div>").html(DataforMap[i]["title"]).text()]=bubbles[i];i++});bubbles[0].addTo(mapdataviz);updateMultiLegend(DataforMap[0],"size");updateMultiLegend(DataforMap1[matchIndex[0]-1],"color");window.mapLayerIndex=0;window.mapLayerMatchIndex=matchIndex;if(DataforMap.length>1){if($(window).width()<750){L.control.layers(layerName,null,{collapsed:true}).addTo(mapdataviz)}else{L.control.layers(layerName,null,{collapsed:false}).addTo(mapdataviz)}}$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateMultiLegend(DataforMap[index],"size");updateMultiLegend(DataforMap1[matchIndex[index]-1],"color");mapdataviz.closePopup();window.mapLayerIndex=index})}else if(bubbleMap=="colored"){L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:false}).addTo(mapdataviz);for(i=0;i<DataforMap.length-1;i++){bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSizeColorGeneric(DataforMap[0],DataforMap[i+1]),onEachFeature:highlightAndPopup});layerName[$("<div>").html(DataforMap[i+1]["title"]).text()]=bubbles[i]}bubbles[0].addTo(mapdataviz);updateLegend(DataforMap[0],"size");updateLegend(DataforMap[1],"color");if(DataforMap.length-1>1){if($(window).width()<750){L.control.layers(layerName,null,{collapsed:true}).addTo(mapdataviz)}else{L.control.layers(layerName,null,{collapsed:false}).addTo(mapdataviz)}}$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateLegend(DataforMap[index+1],"color")})}else if(bubbleMap=="coloredPairUnpair"){L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:false}).addTo(mapdataviz);for(i=0;i<DataforMap.length/2;i++){bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSizeColorGeneric(DataforMap[i*2],DataforMap[i*2+1]),onEachFeature:highlightAndPopup});layerName[$("<div>").html(DataforMap[i*2]["title"]).text()]=bubbles[i]}bubbles[0].addTo(mapdataviz);updateLegend(DataforMap[0],"size");updateLegend(DataforMap[1],"color");if(DataforMap.length-1>1){if($(window).width()<750){L.control.layers(layerName,null,{collapsed:true}).addTo(mapdataviz)}else{L.control.layers(layerName,null,{collapsed:false}).addTo(mapdataviz)}}$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateLegend(DataforMap[index*2],"size");updateLegend(DataforMap[index*2+1],"color")})}else if(bubbleMap=="simple"){L.geoJson(mapShapes,{style:getBasicCountryShapesStyle,clickable:false}).addTo(mapdataviz);for(i=0;i<DataforMap.length;i++){bubbles[i]=L.geoJson(mapCentroides,{pointToLayer:bubblesSimpleGeneric(DataforMap[i]),onEachFeature:highlightAndPopup});layerName[$("<div>").html(DataforMap[i]["title"]).text()]=bubbles[i]}bubbles[0].addTo(mapdataviz);if(flowStatus=="flow"){updateLegend(DataforMap[0],"flows");updateFlowData(DataforMap[0]["code"]);window.maxBubble=DataforMap[0]["max"]}else{updateLegend(DataforMap[0],"size")}if(DataforMap.length>1){if($(window).width()<750){L.control.layers(layerName,null,{collapsed:true}).addTo(mapdataviz)}else{L.control.layers(layerName,null,{collapsed:false}).addTo(mapdataviz)}}$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();if(flowStatus=="flow"){updateFlowData(DataforMap[index]["code"]);clearFlows();clearFlowLegend();updateLegend(DataforMap[index],"flows");window.maxBubble=DataforMap[index]["max"]}else{updateLegend(DataforMap[index],"size")}})}else{var shapes=[];var layerGroup=[];var mapSubPoints=getMapSubPoints(mapCentroides);for(i=0;i<DataforMap.length;i++){shapes[i]=L.geoJson(mapShapes,{style:getColorCountryShapesStyleGeneric(DataforMap[i]),onEachFeature:highlightAndPopup,clickable:false});if(mapSubPoints!=undefined){bubbles[i]=L.geoJson(mapSubPoints,{pointToLayer:bubblesSimpleColorGeneric(DataforMap[i]),onEachFeature:highlightAndPopup});layerGroup[i]=L.layerGroup([shapes[i],bubbles[i]])}else{layerGroup[i]=L.layerGroup([shapes[i]])}L.stamp(layerGroup[i]);layerName[$("<div>").html(DataforMap[i]["title"]).text()]=layerGroup[i]}layerGroup[DataforMapAll.defaultLayer].addTo(mapdataviz);updateLegend(DataforMap[DataforMapAll.defaultLayer],"color");if(DataforMap.length>1){if($(window).width()<750||embed==2){L.control.layers(layerName,null,{collapsed:true}).addTo(mapdataviz)}else{L.control.layers(layerName,null,{collapsed:false}).addTo(mapdataviz)}}$(".leaflet-control-layers-selector").click(function(){var index=$(this).parent().index();updateLegend(DataforMap[index],"color")})}}function textColor(hex){var match=hex.match(/^#(..)(..)(..)$/);if(match){var rgb=match.slice(1).map(function(s){return parseInt(s,16)/255});var L=(Math.min.apply(null,rgb)+Math.max.apply(null,rgb))/2;return L<.5?"#fff":"#000"}else{return"#000"}}function updateLegend(Data,mode){if(mode=="color"){if(Data){var colors=Data["colors"];$("#legendMinColor").parent().parent().empty().append(colors.map(function(color,idx,colors){var el=$("<li>");if(idx===0){el.addClass("firstLegendElement");el.append($('<span id="legendMinColor" class="firstLegendElement">').css("background",color).css("color",textColor(color)))}else if(idx+1===colors.length){el.addClass("lastLegendElement");el.append($('<span id="legendMaxColor" class="lastLegendElement">').css("background",color).css("color",textColor(color)))}else{el.append($("<span>").css("background",color))}return el}));$("#legendMaxColor").html(getHumanReadData(Data["max"],Data["options"]["tooltipDecimals"]));$("#legendMinColor").html(getHumanReadData(Data["min"],Data["options"]["tooltipDecimals"]));$("#legendTitleColor").text($("<div>").html(Data["title"]).text());if("mapRegion"in Data["options"]&&Data["options"]["mapRegion"]!=""&&Data["values"][Data["options"]["mapRegion"]]){var subtext=lang_countries[Data["options"]["mapRegion"].toLowerCase()]+": "+getHumanReadData(Data["values"][Data["options"]["mapRegion"]][1],Data["options"]["tooltipDecimals"]);if(Data["options"]["tooltipUnit"]!=""){subtext+=" "+Data["options"]["tooltipUnit"]}if(Data["values"][Data["options"]["mapRegion"]][0]!=Data["latestYear"]){subtext+=" ("+Data["values"][Data["options"]["mapRegion"]][0]+")"}$("#legendSubtextColor").html(subtext);$("#legendSubtextColor").show();if("mapSource"in lang_labels){$("#topContainer").css("height","66px")}else{$("#topContainer").css("height","58px")}}else{if("mapSource"in lang_labels){$("#topContainer").css("height","58px")}$("#legendSubtextColor").hide()}if(window.relatedDataControl){window.relatedDataControl.updateColors(function(id){return Data.values[id]&&quantize(Data.values[id][1],Data.min,Data.max,Data.colors)})}if(Data["options"]["tooltipUnit"]!=""){$("#legendUnitColor").text(", "+Data["options"]["tooltipUnit"])}else{$("#legendUnitColor").text("")}$("#legendYearColor").text(Data["latestYear"])}else{$("#legendMaxColor").html("");$("#legendMinColor").html("");$("#legendTitleColor").text("No data available");$("#legendUnitColor").text("");$("#legendYearColor").text("")}}else if(mode=="flows"){if(Data){$("#legendBubble").html(window.lang_labels["min"]+": "+getHumanReadData(Data["min"],Data["options"]["tooltipDecimals"])+" - "+window.lang_labels["max"]+": "+getHumanReadData(Data["max"],Data["options"]["tooltipDecimals"]));$("#legendTitleSize").text($("<div>").html(Data["title"]).text());if(Data["options"]["tooltipUnit"]!=""){$("#legendUnitSize").text(", "+Data["options"]["tooltipUnit"])}else{$("#legendUnitSize").text("")}$("#legendYearSize").text("")}else{$("#legendBubble").html("");$("#legendTitleSize").text("No data available");$("#legendUnitSize").text("");$("#legendYearSize").text("")}}else{if(Data){$("#legendBubble").html(window.lang_labels["min"]+": "+getHumanReadData(Data["min"],Data["options"]["tooltipDecimals"])+" - "+window.lang_labels["max"]+": "+getHumanReadData(Data["max"],Data["options"]["tooltipDecimals"]));$("#legendTitleSize").text($("<div>").html(Data["title"]).text());if(Data["options"]["tooltipUnit"]!=""){$("#legendUnitSize").text(", "+Data["options"]["tooltipUnit"])}else{$("#legendUnitSize").text("")}$("#legendYearSize").text(Data["latestYear"])}else{$("#legendBubble").html("");$("#legendTitleSize").text("No data available");$("#legendUnitSize").text("");$("#legendYearSize").text("")}}$("#flowLayer .commodity").text(Data["title"])}function updateMultiLegend(Data,mode){if(mode=="color"){if(Data){$("#legendMaxColor").html(getHumanReadData(Data["max"],Data["options"]["tooltipDecimals"]));$("#legendMinColor").html(getHumanReadData(Data["min"],Data["options"]["tooltipDecimals"]));$("#legendTitleColor").text($("<div>").html(Data["title"]).text());if(Data["options"]["tooltipUnit"]!=""){$("#legendUnitColor").text(", "+Data["unit"])}else{$("#legendUnitColor").text("")}$("#legendYearColor").text("")}else{$("#legendMaxColor").html("");$("#legendMinColor").html("");$("#legendTitleColor").text("No data available");$("#legendUnitColor").text("");$("#legendYearColor").text("")}}else{if(Data){$("#legendBubble").html(window.lang_labels["min"]+": "+getHumanReadData(Data["min"],Data["options"]["tooltipDecimals"])+" - "+window.lang_labels["max"]+": "+getHumanReadData(Data["max"],Data["options"]["tooltipDecimals"]));$("#legendTitleSize").text($("<div>").html(Data["title"]).text());if(Data["options"]["tooltipUnit"]!=""){$("#legendUnitSize").text(", "+Data["unit"])}else{$("#legendUnitSize").text("")}$("#legendYearColor").text("")}else{$("#legendBubble").html("");$("#legendTitleSize").text("No data available");$("#legendUnitSize").text("");$("#legendYearSize").text("")}}}function setLegend(chartType,bubbleMap){if(bubbleMap=="colored"||bubbleMap=="multiColored"||bubbleMap=="coloredPairUnpair"){$("#textLegend").hide()}else if(bubbleMap=="simple"){$("#colorLegend").hide();if(chartType=="mapWizard"){$("#textLegend").hide();$("#sizeLegend").css({width:"100%"})}}else{$("#sizeLegend").hide();if(chartType=="mapWizard"){$("#textLegend").hide();$("#colorLegend").css({width:"100%"})}}}function loopMapIndicator(mode){if(mode=="color"){setInterval(changeColor,2e3)}else if(mode=="bubble"){setInterval(changeBubble,2e3)}var currentLayer=0;function changeBubble(){mapdataviz.removeLayer(bubbles[currentLayer]);layer=Math.floor(Math.random()*bubbles.length+1);currentLayer=layer-1;bubbles[currentLayer].addTo(mapdataviz);updateLegend(DataforMap[currentLayer],"size")}function changeColor(){mapdataviz.removeLayer(shapes[currentLayer]);layer=Math.floor(Math.random()*shapes.length+1);currentLayer=layer-1;shapes[currentLayer].addTo(mapdataviz);updateLegend(DataforMap[currentLayer],"color")}}var landmass;var landmassBorder;var landmassBorderWidth;var landmassGroup;var bubbleDefaultBorder;var bubbleDefaultColor;var bubbleHighlightBorder;var shapeHighlightBorder;if(themeURL=="ecb"){landmass="#f0f0f0";landmassNA="#fff";landmassBorder="#000";landmassBorderWidth=.5;landmassGroup="#f0f0f0";bubbleDefaultBorder="#494444";bubbleDefaultColor="#d56620";bubbleHighlightBorder="#fff";shapeHighlightBorder="#fff"}else{landmass="#939393";landmassNA="#939393";landmassBorder="#939393";landmassBorderWidth=1;landmassGroup="#BBBBBB";bubbleDefaultBorder="#494444";bubbleDefaultColor="#d56620";bubbleHighlightBorder="#fff";shapeHighlightBorder="#fff"}if(project=="trade-in-raw-materials"){landmass="#BBBBBB";landmassNA="#BBBBBB"}if(project=="itf-test"){landmass="#BBBBBB";landmassNA="#BBBBBB"}function getColorCountryShapesStyleGeneric(layerData){return function(feature){if(feature&&feature.properties&&layerData["values"][feature.properties[mapCode]]!=null){return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:getIndicatorColorScale(layerData["values"][feature.properties[mapCode]][1],layerData["min"],layerData["max"],feature,layerData["colors"])||landmassNA,className:"hasValue"}}else if(feature&&feature.properties&&$.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1){return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:landmassNA,className:"hasValue"}}else if(feature&&feature.properties&&$.inArray(feature.properties[mapCode].toString().toLowerCase(),["aut","bel","cyp","deu","esp","est","fin","fra","grc","irl","ita","ltu","lux","lva","mlt","nld","prt","svk","svn"])>-1){return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:"#004996",className:"hasValue"}}else if(feature&&feature.properties&&feature.properties[mapCode]){return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:landmass,className:"hasValue"}}else{return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:landmassGroup,className:"hasValue"}}}}function bubblesSimpleGeneric(Data){return function(feature,latlng){return L.circleMarker(latlng,getBubbleStyleGeneric(feature,Data))}}function bubblesSimpleColorGeneric(colorData){return function(feature,latlng){return L.circleMarker(latlng,getBubbleColorGeneric(feature,colorData))}}function bubblesSizeColorGeneric(sizeData,colorData){return function(feature,latlng){return L.circleMarker(latlng,getBubbleSizeColorGeneric(feature,sizeData,colorData))}}function getBubbleStyleGeneric(feature,layerData){var bubbleColor;if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1&&layerData["values"][feature.properties[mapCode]]!=null){bubbleColor=bubbleDefaultColor;if(layerData["values"][feature.properties[mapCode]]!=null){var radius=getBubbleSize(layerData["values"][feature.properties[mapCode]][1],layerData["max"],feature);if(radius!=null){return{radius:radius,fillColor:bubbleColor,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}}}return{radius:0,opacity:0}}function getBubbleSizeColorGeneric(feature,sizeData,colorData){var bubbleColor;if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1&&sizeData["values"][feature.properties[mapCode]]!=null){radius=getBubbleSize(sizeData["values"][feature.properties[mapCode]][1],sizeData["max"],feature);if(colorData!=null){if(colorData["values"][feature.properties[mapCode]]!=null){var bubbleColor=getIndicatorColorScale(colorData["values"][feature.properties[mapCode]][1],colorData["min"],colorData["max"],feature,colorData["colors"]);if(radius!=null){return{radius:radius,fillColor:bubbleColor,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}}}else{if(radius!=null){return{radius:radius,fillColor:bubbleDefaultBorder,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}}}return{radius:0,opacity:0}}function getBubbleColorGeneric(feature,colorData){var bubbleColor;if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1){radius=5;if(colorData["values"][feature.properties[mapCode]]!=null){var bubbleColor=getIndicatorColorScale(colorData["values"][feature.properties[mapCode]][1],colorData["min"],colorData["max"],feature,colorData["colors"]);if(radius!=null){return{radius:radius,fillColor:bubbleColor,color:bubbleDefaultBorder,weight:1,opacity:1,fillOpacity:1}}}}return{radius:0,opacity:0}}function getBasicCountryShapesStyle(feature){function getBasicGroupColor(feature){if($.inArray(feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1){return landmassGroup}else{return landmass}}return{weight:landmassBorderWidth,opacity:1,color:landmassBorder,fillOpacity:1,fillColor:getBasicGroupColor(feature)}}var colorIdx=0,flowGroup=L.layerGroup(),activeLayer="";function clickFlow(e){var layer=e.target;var layerCode=layer.feature.properties[mapCode];var color=["blue","blue","blue"];clearFlows();if(activeLayer!=layerCode&&$.inArray(layerCode.toLowerCase(),MapGroup)>-1){addLines({center:layerCode,stars:getFlows(layerCode)},color[colorIdx],centroides,mapdataviz);colorIdx=(colorIdx+1)%3;activeLayer=layerCode;updateFlowLegend(layerCode)}else{activeLayer=""}}function clearFlows(){flowGroup.clearLayers().addTo(mapdataviz)}function getFlows(country){var data=window.DataforFlow;var idxCountry=data.keys[0].indexOf(country.toUpperCase());var newData={};var max=0;$.each(data.keys[1],function(key,value){var crData=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];if(max<crData){max=crData}});$.each(data.keys[1],function(key,value){var crData1=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];if(crData1/max>.01){newData[value]=getLineSize(crData1,window.maxBubble)}else{newData[value]=0}});function getLineSize(d,max){if(d==null||d<=0)return null;var width=Math.sqrt(d/max)*25;return width}return newData}function clearFlowLegend(){$("#flowLayer .helptext").show();$("#flowLayer #detailsTable").hide();$("#flowLayer .countryPrefix").text("");$("#flowLayer .country").html("")}function updateFlowLegend(layerCode){var flowLabels={tableHead1:{en:"Main export destinations",cn:"主要出口目的地"},tableHead2:{en:"USD Millions",cn:"百万美元"},world:{en:"World",cn:"世界"},unspecified:{en:"unspecified",cn:"未标明"},asia:{en:"Asia n.e.s.",cn:"亚洲n.e.s."},headlinePrefix:{en:"Exports from ",cn:"从"},headlineSuffix:{en:"",cn:"的出口"}};if(window.lang_countries[layerCode.toLowerCase()]!=null){$("#flowLayer .country").html(window.lang_countries[layerCode.toLowerCase()])}else{$("#flowLayer .country").html(layerCode)}$("#flowLayer #countryPrefix").text(flowLabels.headlinePrefix[lang]);$("#flowLayer #countrySuffix").text(flowLabels.headlineSuffix[lang]);$("#flowLayer .helptext").hide();$("#flowLayer #detailsTable").show();$("#flowLayer #detailsTable thead .countries").text(flowLabels.tableHead1[lang]);$("#flowLayer #detailsTable thead .values").text(flowLabels.tableHead2[lang]);$("#flowLayer #detailsTable tbody").remove();$("#flowLayer #detailsTable").append("<tbody>");var legendData=getFlowsLegend(layerCode);$.each(legendData["rank"],function(key,value){if(window.lang_countries[legendData["values"][value].toLowerCase()]!=null){country=window.lang_countries[legendData["values"][value].toLowerCase()]}else if(legendData["values"][value]=="WLD"){country=flowLabels.world[lang]}else if(legendData["values"][value]=="UNSPE"){country=flowLabels.unspecified[lang]}else if(legendData["values"][value]=="XCD"){country=flowLabels.asia[lang]}else{country=legendData["values"][value]}$("#flowLayer #detailsTable tbody").append("<tr><td>"+country+'</td><td  class="tableValues">'+Math.round(value/1e6)+"</td>")});function getFlowsLegend(country){var data=window.DataforFlow;var idxCountry=data.keys[0].indexOf(country.toUpperCase());var newData={};newData["rank"]=[];newData["values"]={};var max=0;$.each(data.keys[1],function(key,value){var crData=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];if(max<crData){max=crData}});$.each(data.keys[1],function(key,value){var crData1=data.data[idxCountry][data.keys[1].indexOf(value.toUpperCase())][0];if(crData1/max>.01){newData["values"][crData1]=value;newData["rank"].push(crData1)}});newData["rank"].sort(function(a,b){return b-a});return newData}}function addLines(flow,color,centros,mapdataviz){var stars={};$.each(flow.stars,function(country,value){if(centros[country.toUpperCase()]!=undefined){stars[country]={};stars[country]["latlong"]=[parseFloat(centros[country.toUpperCase()].Lat),parseFloat(centros[country.toUpperCase()].Long)];stars[country]["value"]=value}});var center=[parseFloat(centros[flow.center.toUpperCase()].Lat),parseFloat(centros[flow.center.toUpperCase()].Long)];$.each(stars,function(country,values){var lines=L.polyline([center,values.latlong],{color:color,weight:values.value,fill:"blue"});flowGroup.addLayer(lines)})}function updateFlowData(indicator){$.ajax({dataType:"json",url:baseURL+"/api-data?project="+project+"&id="+indicator,success:ajaxSuccess,error:function(xhr,ajaxOptions,thrownError){if(xhr.status=="404"){alert("No data available.")}}});function ajaxSuccess(data){if(data!=null){window.DataforFlow=data}else{alert("No data available.")}}}L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI+90},getPointPathPixelLength:function(a){var b=a.length;if(2>b)return 0;for(var c=0,d=a[0],e=1;e<b;e++)c+=d.distanceTo(d=a[e]);return c},getPixelLength:function(a,b){var c=a instanceof L.Polyline?a.getLatLngs():a,d=c.length;if(2>d)return 0;for(var e=0,f=b.project(c[0]),g=1;g<d;g++)e+=f.distanceTo(f=b.project(c[g]));return e},projectPatternOnPath:function(a,b,c,d){var e=[],f;f=0;for(l=a.length;f<l;f++)e[f]=d.project(a[f]);a=this.projectPatternOnPointPath(e,b,c);f=0;for(l=a.length;f<l;f++)a[f].latLng=d.unproject(a[f].pt);return a},projectPatternOnPointPath:function(a,b,c){var d=[],e=this.getPointPathPixelLength(a)*c;b=this.interpolateOnPointPath(a,b);d.push(b);if(0<c){a=a.slice(b.predecessor);a[0]=b.pt;for(c=this.getPointPathPixelLength(a);e<=c;)b=this.interpolateOnPointPath(a,e/c),d.push(b),a=a.slice(b.predecessor),a[0]=b.pt,c=this.getPointPathPixelLength(a)}return d},interpolateOnPointPath:function(a,b){var c=a.length;if(2>c)return null;if(0>=b)return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])};if(1<=b)return{pt:a[c-1],predecessor:c-1,heading:this.computeAngle(a[c-2],a[c-1])};if(2==c)return{
pt:this.interpolateBetweenPoints(a[0],a[1],b),predecessor:0,heading:this.computeAngle(a[0],a[1])};for(var d=this.getPointPathPixelLength(a),e=a[0],f=e,g=0,h=0,k=0,j=1;j<c&&h<b;j++)e=f,g=h,f=a[j],k+=e.distanceTo(f),h=k/d;return{pt:this.interpolateBetweenPoints(e,f,(b-g)/(h-g)),predecessor:j-2,heading:this.computeAngle(e,f)}},interpolateBetweenPoints:function(a,b,c){return b.x!=a.x?new L.Point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y):new L.Point(a.x,a.y+(b.y-a.y)*c)}};L.RotatedMarker=L.Marker.extend({options:{angle:0},_setPos:function(a){L.Marker.prototype._setPos.call(this,a);if(L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var b=this.options.angle*L.LatLng.DEG_TO_RAD;a=Math.cos(b);b=Math.sin(b);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+a+", M12="+-b+", M21="+b+", M22="+a+")"}}});L.rotatedMarker=function(a,b){return new L.RotatedMarker(a,b)};L.Symbol=L.Symbol||{};L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c){b=this.options;if(1>=b.pixelSize)return new L.Polyline([a.latLng,a.latLng],b.pathOptions);var d=c.project(a.latLng);a=-(a.heading-90)*L.LatLng.DEG_TO_RAD;a=new L.Point(d.x+b.pixelSize*Math.cos(a+Math.PI)/2,d.y+b.pixelSize*Math.sin(a)/2);d=d.add(d.subtract(a));return new L.Polyline([c.unproject(a),c.unproject(d)],b.pathOptions)}});L.Symbol.dash=function(a){return new L.Symbol.Dash(a)};L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c){b=this.options;return b.polygon?new L.Polygon(this._buildArrowPath(a,c),b.pathOptions):new L.Polyline(this._buildArrowPath(a,c),b.pathOptions)},_buildArrowPath:function(a,b){var c=b.project(a.latLng),d=-(a.heading-90)*L.LatLng.DEG_TO_RAD,e=this.options.headAngle/2*L.LatLng.DEG_TO_RAD,f=d+e,d=d-e,f=new L.Point(c.x-this.options.pixelSize*Math.cos(f),c.y+this.options.pixelSize*Math.sin(f)),c=new L.Point(c.x-this.options.pixelSize*Math.cos(d),c.y+this.options.pixelSize*Math.sin(d));return[b.unproject(f),a.latLng,b.unproject(c)]}});L.Symbol.arrowHead=function(a){return new L.Symbol.ArrowHead(a)};L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(a){L.Util.setOptions(this,a);this.options.markerOptions.clickable=!1;this.options.markerOptions.draggable=!1;this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(a){return this.options.rotate?(this.options.markerOptions.angle=a.heading,new L.RotatedMarker(a.latLng,this.options.markerOptions)):new L.Marker(a.latLng,this.options.markerOptions)}});L.Symbol.marker=function(a){return new L.Symbol.Marker(a)};L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(a,b){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,b);this._map=null;this._initPaths(a);this._initPatterns()},_initPaths:function(a){this._paths=[];var b=!1;if(a instanceof L.MultiPolyline||(b=a instanceof L.MultiPolygon)){a=a.getLatLngs();for(var c=0;c<a.length;c++)this._initPath(a[c],b)}else if(a instanceof L.Polyline)this._initPath(a.getLatLngs(),a instanceof L.Polygon);else if(L.Util.isArray(a)&&0<a.length)if(a[0]instanceof L.Polyline)for(c=0;c<a.length;c++)this._initPath(a[c].getLatLngs(),a[c]instanceof L.Polygon);else this._initPath(a)},_isCoordArray:function(a){return L.Util.isArray(a)&&0<a.length&&(a[0]instanceof L.LatLng||L.Util.isArray(a[0])&&2==a[0].length&&"number"===typeof a[0][0])},_initPath:function(a,b){var c;c=this._isCoordArray(a)?[a]:a;for(var d=0;d<c.length;d++)b&&c[d].push(c[d][0]),this._paths.push(c[d])},_initPatterns:function(){this._isZoomDependant=!1;this._patterns=[];for(var a,b=0;b<this.options.patterns.length;b++)a=this._parsePatternDef(this.options.patterns[b]),this._patterns.push(a),this._isZoomDependant=this._isZoomDependant||a.isOffsetInPixels||a.isRepeatInPixels||a.symbolFactory.isZoomDependant},setPatterns:function(a){this.options.patterns=a;this._initPatterns();this._softRedraw()},setPaths:function(a){this._initPaths(a);this.redraw()},_parsePatternDef:function(a){var b={cache:[],symbolFactory:a.symbol,isOffsetInPixels:!1,isRepeatInPixels:!1};"string"===typeof a.offset&&-1!=a.offset.indexOf("%")?b.offset=parseFloat(a.offset)/100:(b.offset=parseFloat(a.offset),b.isOffsetInPixels=0<b.offset);"string"===typeof a.repeat&&-1!=a.repeat.indexOf("%")?b.repeat=parseFloat(a.repeat)/100:(b.repeat=parseFloat(a.repeat),b.isRepeatInPixels=0<b.repeat);return b},onAdd:function(a){this._map=a;this._draw();if(this._isZoomDependant)this._map.on("zoomend",this._softRedraw,this)},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this);this._map=null;L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,b,c){for(var d=[],e=0,f=c.length;e<f;e++)d.push(b.buildSymbol(c[e],a,this._map,e,f));return d},_getCache:function(a,b,c){var d=a.cache[b];return"undefined"===typeof d?(a.cache[b]=[],null):d[c]},_getDirectionPoints:function(a,b){var c=this._map.getZoom(),d=this._getCache(b,c,a);if(d)return d;var e;e=null;var f=this._paths[a];b.isOffsetInPixels?(e=L.LineUtil.PolylineDecorator.getPixelLength(f,this._map),d=b.offset/e):d=b.offset;b.isRepeatInPixels?(e=null!==e?e:L.LineUtil.PolylineDecorator.getPixelLength(f,this._map),e=b.repeat/e):e=b.repeat;d=L.LineUtil.PolylineDecorator.projectPatternOnPath(f,d,e,this._map);return b.cache[c][a]=d},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(a){if(null!==this._map){this.clearLayers();if(a)for(a=0;a<this._patterns.length;a++)this._patterns[a].cache=[];this._draw()}},_drawPattern:function(a){for(var b,c=0;c<this._paths.length;c++){b=this._getDirectionPoints(c,a);b=this._buildSymbols(this._paths[c],a.symbolFactory,b);for(var d=0;d<b.length;d++)this.addLayer(b[d])}},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}});L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)};function highlightAndPopup(feature,layer){if(!(feature&&feature.properties&&feature.properties[mapCode]))return;var interaction;if(window.flowStatus=="flow"){interaction=clickFlow}else{interaction=click}var inEuroArea=feature&&feature.properties&&$.inArray(feature.properties[mapCode].toString().toLowerCase(),["aut","bel","cyp","deu","esp","est","fin","fra","grc","irl","ita","ltu","lux","lva","mlt","nld","prt","svk","svn"])>-1;if(themeURL=="ecb"&&!inEuroArea||$.inArray(layer.feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1){layer.on({click:interaction,mouseover:function(){if(!layer.inFront){layer.inFront=true;layer.setStyle({fillOpacity:.8,weight:2,color:bubbleMap!=null?bubbleHighlightBorder:shapeHighlightBorder}).bringToFront()}},mouseout:function(){layer.inFront=false;layer.setStyle({fillOpacity:1,weight:landmassBorderWidth,color:bubbleMap!=null?bubbleDefaultBorder:landmassBorder});if(typeof disputedLines!=="undefined"){disputedLines.bringToFront()}if(typeof flowGroup!=="undefined"){flowGroup.eachLayer(function(layer){if(layer.bringToFront){layer.bringToFront()}else{layer.eachLayer(function(sublayer){sublayer.bringToFront()})}})}}});if(layer.eachLayer){layer.eachLayer(function(sublayer){L.Util.setOptions(sublayer,{clickable:true})})}else{L.Util.setOptions(layer,{clickable:true})}}}function notClickable(feature,layer){- -L.Util.setOptions(layer,{clickable:false})}function click(e){var layer=e.target;var specialTooltip=window.wizardConfig.tabs[wizardConfig.project.tabs[page]].specialTooltip;var specialTooltipLinks=window.wizardConfig.tabs[wizardConfig.project.tabs[page]].specialTooltipLinks;var teaserText;if(specialTooltip=="export-restrictions-main"){teaserText=mapTeaserExportRestrictionsMain(layer.feature.properties[mapCode])}else if(specialTooltip=="export-restrictions"){teaserText=mapTeaserExportRestrictions(layer.feature.properties[mapCode])}else if(specialTooltip=="ifi-country-data"){teaserText=mapTeaserIfiCountryData(layer.feature.properties[mapCode],specialTooltipLinks)}else if(window.bubbleMap=="multiColored"){teaserText=mapTeaserTextMulti(layer.feature.properties[mapCode])}else{teaserText=mapTeaserText(layer.feature.properties[mapCode])}if(themeURL=="ecb"||$.inArray(layer.feature.properties[mapCode].toString().toLowerCase(),MapGroup)>-1){popup.setLatLng(e.latlng);popup.setContent(teaserText);if(!popup._map)popup.openOn(mapdataviz)}}function popupLoop(countryISO){var teaserText=mapTeaserText(countryISO);popup.setLatLng([Centroides[countryISO]["Lat"],Centroides[countryISO]["Long"]]);mapdataviz.setView([Centroides[countryISO]["Lat"],Centroides[countryISO]["Long"]],2);popup.setContent(teaserText);if(!popup._map)popup.openOn(mapdataviz)}function mapTeaserExportRestrictions(country){var labels2={};labels2["en"]={1:"export prohibition",2:"export quota",3:"export tax",4:"non-automatic licencing",5:"other measures",6:"no restrictions",undefined:"not reseached"};labels2["cn"]={1:"禁止出口",2:"出口配额",3:"出口税",4:"非自动许可",5:"其他措施",6:"无限制",undefined:"没有研究"};var teaserTitleStart='<h3 class="tooltipTitle">';var teaserTitleEnd="</h3>";var teaserTableStart='<table class="tooltipTable">';var teaserTableLineCenter='</td><td  class="tooltipData">';var teaserTableEnd="</td></tr></table>";var countryProfile="<div class='countryProfilLink'>"+"<span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span>"+"</div>";var countryName=lang_countries[country.toLowerCase()]+" - "+DataforMap[mapLayerIndex]["title"];var tableLines;var tableLine=[];if(DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]){tableLine[0]="<tr>"+"<td>"+DataforMap[mapLayerIndex]["options"]["tooltipUnit"]+":</td>"+"<td class='tooltipData'>"+getHumanReadData(DataforMap[mapLayerIndex]["values"][country][1])+" "+DataforMap[mapLayerIndex]["unit"]+"</td>"+"</tr>";tableLine[1]="<tr>"+"<td>"+DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]["options"]["tooltipUnit"]+":</td>"+"<td class='tooltipData'>"+labels2[lang][DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]["values"][country][1]]+"</td>"+"</tr>"}else{tableLine[0]="<tr>"+"<td>"+DataforMap[mapLayerIndex]["options"]["tooltipUnit"]+":</td>"+"<td class='tooltipData'>"+labels2[lang][DataforMap[mapLayerIndex]["values"][country][1]]+"</td>"+"</tr>";tableLine[1]="<tr><td></td><td></td></tr>"}tableLines=tableLine[0]+tableLine[1];return""+teaserTitleStart+countryName+teaserTitleEnd+teaserTableStart+tableLines+teaserTableEnd+countryProfile+""}function mapTeaserExportRestrictionsMain(country){var labels2={};labels2["en"]={1:"export prohibition",2:"export quota",3:"export tax",4:"non-automatic licencing",5:"other measures",6:"no restrictions",undefined:"not reseached"};labels2["cn"]={1:"禁止出口",2:"出口配额",3:"出口税",4:"非自动许可",5:"其他措施",6:"无限制",undefined:"没有研究"};var teaserTitleStart='<h3 class="tooltipTitle">';var teaserTitleEnd="</h3>";var teaserTableStart='<table class="tooltipTable">';var teaserTableLineCenter='</td><td  class="tooltipData">';var teaserTableEnd="</td></tr></table>";var countryProfile="<div class='countryProfilLink'>"+"<span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span>"+"</div>";var countryName=lang_countries[country.toLowerCase()];var tableLineCanvas=[];var tooltipData=[];var tableLines;tableLineCanvas[0]="<tr><td title='"+DataforMap[0]["definition"]+"'>"+DataforMap[0]["title"]+":</td><td class='tooltipData'>";tooltipData[0]=labels2[lang][DataforMap[0]["values"][country][1]];tableLines=tableLineCanvas[0]+tooltipData[0];return""+teaserTitleStart+countryName+teaserTitleEnd+teaserTableStart+tableLines+teaserTableEnd+countryProfile+""}function mapTeaserIfiCountryData(country,links){var teaser=$("<div>");var teaserTitle=$('<h3 class="tooltipTitle">');var teaserTable=$('<table class="tooltipTable">');teaser.append(teaserTitle);var link=links[country.toString().toLowerCase()];if(link!=null){var countryProfile=$('<div style="text-align: center;">').append($('<a target="_blank">').attr("href",link).text(lang_labels.countryProfile));teaser.append(countryProfile)}var countryName=lang_countries[country.toString().toLowerCase()]||country;teaserTitle.text(countryName);var tableLineCanvas;var tooltipData;var dataValue;var hasData=false;var unit;for(var i=0;i<ChartsWithData;i++){if(DataforMap[i]!=null){tableLineCanvas=$("<tr>").append($("<td>").attr("title",$("<div>").html(DataforMap[i]["definition"]).text()).html(DataforMap[i]["title"]));tooltipData=$('<td class="tooltipData">');tableLineCanvas.append(tooltipData);if(DataforMap[i]["values"][country]!=undefined&&DataforMap[i]["values"][country][1]!=null){hasData=true;dataValue=getHumanReadData(DataforMap[i]["values"][country][1],DataforMap[i]["options"]["tooltipDecimals"]);unit=DataforMap[i]["options"]["tooltipUnit"]||"";if(unit!==""){dataValue+="&nbsp;"+unit}if(DataforMap[i]["values"][country][0]!=DataforMap[i]["latestYear"]){dataValue+="&nbsp;("+DataforMap[i]["values"][country][0]+")"}tooltipData.html(dataValue)}else{tooltipData.text("—")}teaserTable.append(tableLineCanvas)}}teaserTitle.after(teaserTable);return teaser[0]}function mapTeaserText(country){var euGroup=["aut","bel","bgr","cyp","deu","dnk","esp","fin","fra","gbr","grc","hrv","irl","ita","lux","lva","ltu","mlt","nld","prt","swe","cze","est","hun","pol","svk","svn","rou"];var teaser=$("<div>");var teaserTitle=$('<h3 class="tooltipTitle">');var teaserTable=$('<table class="tooltipTable">');teaser.append(teaserTitle);var countryProfile=$('<div class="countryProfilLink">').append($('<span id="countryProfileMap">').attr("value",country).html(lang_labels.countryProfile));if(typeof wizardConfig!=="undefined"&&wizardConfig.tabs[wizardConfig.project.tabs[page]].countrynotes=="withEU"&&$.inArray(country.toString().toLowerCase(),euGroup)>-1){countryProfile.append('<span value="eu" id="euProfileMap">view EU profile</span>')}teaser.append(countryProfile);var countryName=lang_countries[country.toString().toLowerCase()]||ISO3toFlags[country]||country;teaserTitle.text(countryName);var tableLineCanvas;var tooltipData;var dataValue;var hasData=false;for(var i=0;i<ChartsWithData;i++){if(DataforMap[i]!=null){tableLineCanvas=$("<tr>").append($("<td>").attr("title",$("<div>").html(DataforMap[i]["definition"]).text()).html(DataforMap[i]["title"]));tooltipData=$('<td class="tooltipData">');tableLineCanvas.append(tooltipData);if(DataforMap[i]["values"][country]!=undefined&&DataforMap[i]["values"][country][1]!=null){hasData=true;dataValue=getHumanReadData(DataforMap[i]["values"][country][1],DataforMap[i]["options"]["tooltipDecimals"])+"&nbsp;"+DataforMap[i]["options"]["tooltipUnit"];if(DataforMap[i]["values"][country][0]!=DataforMap[i]["latestYear"]){dataValue+="&nbsp;("+DataforMap[i]["values"][country][0]+")"}tooltipData.html(dataValue)}else{tooltipData.text("—")}teaserTable.append(tableLineCanvas)}}if(hasData||themeURL!="ecb"){teaserTitle.after(teaserTable)}return teaser[0]}function mapTeaserTextMulti(country){var euGroup=["aut","bel","bgr","cyp","deu","dnk","esp","fin","fra","gbr","grc","hrv","irl","ita","lux","lva","ltu","mlt","nld","prt","swe","cze","est","hun","pol","svk","svn","rou"];var teaserTitleStart='<h3 class="tooltipTitle">';var teaserTitleEnd="</h3>";var teaserTableStart='<table class="tooltipTable">';var teaserTableLineCenter='</td><td  class="tooltipData">';var teaserTableEnd="</td></tr></table>";if(typeof wizardConfig!=="undefined"&&wizardConfig.tabs[wizardConfig.project.tabs[page]].countrynotes=="withEU"&&$.inArray(country.toString().toLowerCase(),euGroup)>-1){var countryProfile="<div class='countryProfilLink'>"+"<span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span>"+""+"<span value='eu' id='euProfileMap' >view EU profile</span>"+"</div>"}else{var countryProfile="<div class='countryProfilLink'>"+"<span value='"+country+"' id='countryProfileMap'>"+lang_labels.countryProfile+"</span>"+"</div>"}if(lang_countries[country.toString().toLowerCase()]!=null){var countryName=lang_countries[country.toString().toLowerCase()]+" - "+DataforMap[mapLayerIndex]["title"]}else{var countryName=country+" - "+DataforMap[mapLayerIndex]["title"]}var tableLines;var tableLine=[];tableLine[0]="<tr>"+"<td>"+DataforMap[mapLayerIndex]["options"]["tooltipUnit"]+"</td>"+"<td class='tooltipData'>"+getHumanReadData(DataforMap[mapLayerIndex]["values"][country][1])+"</td>"+"</tr>";if(DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]){tableLine[1]="<tr>"+"<td>"+DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]["options"]["tooltipUnit"]+"</td>"+"<td class='tooltipData'>"+getHumanReadData(DataforMap1[mapLayerMatchIndex[mapLayerIndex]-1]["values"][country][1])+"</td>"+"</tr>"}else{tableLine[1]="<tr><td></td><td></td></tr>"}tableLines=tableLine[0]+tableLine[1];return""+teaserTitleStart+countryName+teaserTitleEnd+teaserTableStart+tableLines+teaserTableEnd+countryProfile+""}
//# sourceMappingURL=mapWizardSimple.js.map